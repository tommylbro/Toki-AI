{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Tommy\\\\Desktop\\\\my-chatbot-app\\\\src\\\\App.js\",\n  _s = $RefreshSig$();\n/* global __firebase_config, __app_id, __initial_auth_token */\n\n// import AppWindow from './index.js'; // (Unused import removed or comment out if not needed)\nimport { useState, useEffect, useRef } from 'react';\nimport { initializeApp } from 'firebase/app';\nimport { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged, sendSignInLinkToEmail, isSignInWithEmailLink, signInWithEmailLink, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from 'firebase/auth';\nimport { getFirestore, collection, onSnapshot, addDoc, serverTimestamp, doc, setDoc, query, limit, getDocs } from 'firebase/firestore';\nimport { marked } from 'marked';\nimport { createPortal } from 'react-dom';\nimport { Sparkles, MessageSquareMore, Image, LoaderCircle, X, ExternalLink, Menu, Plus, Play, Pause, Mic, Settings, Volume2, PenTool } from 'lucide-react';\n\n// --- Firebase Configuration ---\n// The global variables are provided by the Canvas environment.\n// We fall back to a local config for development purposes if they are not defined.\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst localFirebaseConfig = {\n  apiKey: \"AIzaSyDhJoNaFf0qgl4VTuUXj16ysJG1hycq-p8\",\n  authDomain: \"ai-chatbot-88602.firebaseapp.com\",\n  projectId: \"ai-chatbot-88602\",\n  storageBucket: \"ai-chatbot-88602.firebasestorage.app\",\n  messagingSenderId: \"167580287666\",\n  appId: \"1:167580287666:web:9e8313ae6e667e47d47fab\",\n  measurementId: \"G-CXKJ8QRLZ1\"\n};\nconst firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : localFirebaseConfig;\nconst appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\nconst initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;\n\n// Utility function for generating unique IDs (like conversation IDs)\nconst generateId = () => {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    const r = Math.random() * 16 | 0,\n      v = c === 'x' ? r : r & 0x3 | 0x8;\n    return v.toString(16);\n  });\n};\n\n// Converts a base64 string to an ArrayBuffer\nfunction base64ToArrayBuffer(base64) {\n  const binaryString = window.atob(base64);\n  const len = binaryString.length;\n  const bytes = new Uint8Array(len);\n  for (let i = 0; i < len; i++) {\n    bytes[i] = binaryString.charCodeAt(i);\n  }\n  return bytes.buffer;\n}\n\n// Converts PCM audio data to a WAV blob\nfunction pcmToWav(pcmData, sampleRate) {\n  const pcm16 = new Int16Array(pcmData);\n  const buffer = new ArrayBuffer(44 + pcm16.length * 2);\n  const view = new DataView(buffer);\n  const writeString = (view, offset, string) => {\n    for (let i = 0; i < string.length; i++) {\n      view.setUint8(offset + i, string.charCodeAt(i));\n    }\n  };\n  let offset = 0;\n  writeString(view, offset, 'RIFF');\n  offset += 4;\n  view.setUint32(offset, 36 + pcm16.length * 2, true);\n  offset += 4;\n  writeString(view, offset, 'WAVE');\n  offset += 4;\n  writeString(view, offset, 'fmt ');\n  offset += 4;\n  view.setUint32(offset, 16, true);\n  offset += 4; // Sub-chunk size\n  view.setUint16(offset, 1, true);\n  offset += 2; // Audio format (1 = PCM)\n  view.setUint16(offset, 1, true);\n  offset += 2; // Number of channels\n  view.setUint32(offset, sampleRate, true);\n  offset += 4; // Sample rate\n  view.setUint32(offset, sampleRate * 2, true);\n  offset += 4; // Byte rate\n  view.setUint16(offset, 2, true);\n  offset += 2; // Block align\n  view.setUint16(offset, 16, true);\n  offset += 2; // Bits per sample\n  writeString(view, offset, 'data');\n  offset += 4;\n  view.setUint32(offset, pcm16.length * 2, true);\n  offset += 4; // Data size\n\n  for (let i = 0; i < pcm16.length; i++) {\n    view.setInt16(offset, pcm16[i], true);\n    offset += 2;\n  }\n  return new Blob([view], {\n    type: 'audio/wav'\n  });\n}\n\n// Prebuilt voices available for TTS\nconst prebuiltVoices = ['Kore', 'Puck', 'Charon', 'Fenrir', 'Leda', 'Orus', 'Aoede', 'Callirrhoe', 'Autonoe', 'Enceladus', 'Iapetus', 'Umbriel', 'Algieba', 'Despina', 'Erinome', 'Algenib', 'Rasalgethi', 'Laomedeia', 'Achernar', 'Alnilam', 'Schedar', 'Gacrux', 'Pulcherrima', 'Achird', 'Zubenelgenubi', 'Vindemiatrix', 'Sadachbia', 'Sadaltager', 'Sulafat'];\n\n// The main App component\nfunction App() {\n  _s();\n  var _conversations$find;\n  const [db, setDb] = useState(null);\n  const [auth, setAuth] = useState(null);\n  const [isAuthReady, setIsAuthReady] = useState(false);\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [emailSent, setEmailSent] = useState(false);\n  const [isSigningInWithLink, setIsSigningInWithLink] = useState(false);\n  const [isAIGenerating, setIsAIGenerating] = useState(false);\n  const [authMode, setAuthMode] = useState('email-link');\n\n  // New states for conversation history and sidebar\n  const [conversations, setConversations] = useState([]);\n  const [currentConversationId, setCurrentConversationId] = useState(null);\n  const [isSidebarOpen, setIsSidebarOpen] = useState(true);\n  const [isSummarizing, setIsSummarizing] = useState(false);\n  const [isGeneratingImage, setIsGeneratingImage] = useState(false);\n  const [isSpeaking, setIsSpeaking] = useState(false);\n  const [voiceName, setVoiceName] = useState('Kore');\n  const [showSettingsModal, setShowSettingsModal] = useState(false);\n  const [selectedImage, setSelectedImage] = useState(null);\n\n  // New states for Gemini features\n  const [systemInstruction, setSystemInstruction] = useState('');\n  const [generationSettings, setGenerationSettings] = useState({\n    temperature: 0.9,\n    topK: 40,\n    topP: 0.95\n  });\n  const [showGeminiModal, setShowGeminiModal] = useState(false);\n  const [translationTargetLanguage, setTranslationTargetLanguage] = useState('en-US');\n  const [textToContinue, setTextToContinue] = useState('');\n  const [textToTranslate, setTextToTranslate] = useState('');\n\n  // New state for the creative writing feature\n  const [showCreativeWriterModal, setShowCreativeWriterModal] = useState(false);\n  const [creativeTopic, setCreativeTopic] = useState('');\n  const [creativeStyle, setCreativeStyle] = useState('Poem');\n  const [creativeTone, setCreativeTone] = useState('Neutral');\n  const messagesEndRef = useRef(null);\n  const audioRef = useRef(null);\n  const currentAudioIdRef = useRef(null);\n  const inputRef = useRef(null); // Added this ref for the input element\n\n  // Scroll to bottom of messages whenever messages change\n  useEffect(() => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  }, [messages]);\n\n  // Exponential backoff utility for API calls\n  const fetchWithExponentialBackoff = async (url, options, retries = 5, delay = 1000) => {\n    try {\n      const response = await fetch(url, options);\n      if (!response.ok) {\n        var _errorData$error;\n        const errorData = await response.json();\n        throw new Error(`API error: ${((_errorData$error = errorData.error) === null || _errorData$error === void 0 ? void 0 : _errorData$error.message) || response.statusText}`);\n      }\n      return response;\n    } catch (error) {\n      if (retries > 0 && error.message.includes(\"API error\")) {\n        await new Promise(resolve => setTimeout(resolve, delay));\n        return fetchWithExponentialBackoff(url, options, retries - 1, delay * 2);\n      }\n      throw error;\n    }\n  };\n\n  // 1. Initialize Firebase and set up authentication.\n  useEffect(() => {\n    if (Object.keys(firebaseConfig).length === 0 || !firebaseConfig.apiKey) {\n      setError('Firebase configuration is missing or incomplete. Please ensure your Firebase config is correctly set, especially the API Key.');\n      setLoading(false);\n      return;\n    }\n    try {\n      const firebaseApp = initializeApp(firebaseConfig);\n      const authInstance = getAuth(firebaseApp);\n      const dbInstance = getFirestore(firebaseApp);\n      setAuth(authInstance);\n      setDb(dbInstance);\n      const unsubscribe = onAuthStateChanged(authInstance, async currentUser => {\n        if (currentUser) {\n          setUser(currentUser);\n          setIsAuthReady(true);\n          setError(null);\n        } else {\n          if (initialAuthToken) {\n            try {\n              await signInWithCustomToken(authInstance, initialAuthToken);\n            } catch (e) {\n              console.error(\"Custom token sign-in failed:\", e);\n              setError(`Custom token sign-in failed: ${e.message}. This usually means the token is invalid or expired. Please try refreshing.`);\n            }\n          } else if (!isSigningInWithLink) {\n            try {\n              await signInAnonymously(authInstance);\n            } catch (e) {\n              console.error(\"Anonymous sign-in failed:\", e);\n              setError(`Anonymous sign-in failed: ${e.message}. Please ensure Anonymous Authentication is enabled in your Firebase project settings.`);\n            }\n          }\n          setIsAuthReady(true);\n        }\n        setLoading(false);\n      });\n      return () => unsubscribe();\n    } catch (e) {\n      setError(`Failed to initialize Firebase: ${e.message}. Please check the console for more details.`);\n      setLoading(false);\n    }\n  }, []);\n\n  // 2. Handle email link sign-in.\n  useEffect(() => {\n    if (!auth || !isAuthReady) return;\n    if (isSignInWithEmailLink(auth, window.location.href)) {\n      setIsSigningInWithLink(true);\n      setLoading(true);\n      let storedEmail = window.localStorage.getItem('emailForSignIn');\n      if (!storedEmail) {\n        // Using a custom modal instead of prompt\n        const modalDiv = document.createElement('div');\n        modalDiv.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50';\n        modalDiv.innerHTML = `\n          <div class=\"bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg max-w-sm w-full\">\n            <h3 class=\"text-xl font-bold mb-4\">Confirm Email</h3>\n            <p class=\"mb-4\">Please provide your email to complete sign-in.</p>\n            <input id=\"email-confirm-input\" type=\"email\" placeholder=\"Enter your email\" class=\"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500\" required />\n            <button id=\"email-confirm-button\" class=\"w-full bg-indigo-500 text-white p-3 rounded-lg shadow-md hover:bg-indigo-600 transition-colors duration-200\">Confirm</button>\n          </div>\n        `;\n        document.body.appendChild(modalDiv);\n        const emailConfirmInput = modalDiv.querySelector('#email-confirm-input');\n        const emailConfirmButton = modalDiv.querySelector('#email-confirm-button');\n        emailConfirmButton.onclick = () => {\n          storedEmail = emailConfirmInput.value;\n          if (storedEmail) {\n            document.body.removeChild(modalDiv);\n            continueSignIn(storedEmail);\n          } else {\n            console.error(\"Email not provided. Please try again.\");\n          }\n        };\n        const continueSignIn = emailToUse => {\n          signInWithEmailLink(auth, emailToUse, window.location.href).then(result => {\n            window.localStorage.removeItem('emailForSignIn');\n            setUser(result.user);\n            setIsSigningInWithLink(false);\n            setLoading(false);\n            setError(null);\n            window.history.replaceState({}, document.title, window.location.pathname);\n          }).catch(error => {\n            setError(`Error completing sign-in with link: ${error.message}`);\n            setIsSigningInWithLink(false);\n            setLoading(false);\n            window.history.replaceState({}, document.title, window.location.pathname);\n          });\n        };\n        return; // Exit the effect to wait for user input\n      }\n      signInWithEmailLink(auth, storedEmail, window.location.href).then(result => {\n        window.localStorage.removeItem('emailForSignIn');\n        setUser(result.user);\n        setIsSigningInWithLink(false);\n        setLoading(false);\n        setError(null);\n        window.history.replaceState({}, document.title, window.location.pathname);\n      }).catch(error => {\n        setError(`Error completing sign-in with link: ${error.message}`);\n        setIsSigningInWithLink(false);\n        setLoading(false);\n        window.history.replaceState({}, document.title, window.location.pathname);\n      });\n    }\n  }, [auth, isAuthReady]);\n\n  // 3. Fetch conversations for the current user.\n  useEffect(() => {\n    if (!db || !user || !isAuthReady) return;\n    const conversationsCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations');\n    const unsubscribe = onSnapshot(conversationsCollectionRef, querySnapshot => {\n      const fetchedConversations = [];\n      querySnapshot.forEach(doc => {\n        fetchedConversations.push({\n          id: doc.id,\n          ...doc.data()\n        });\n      });\n      fetchedConversations.sort((a, b) => {\n        var _b$lastUpdated, _a$lastUpdated;\n        return (((_b$lastUpdated = b.lastUpdated) === null || _b$lastUpdated === void 0 ? void 0 : _b$lastUpdated.seconds) || 0) - (((_a$lastUpdated = a.lastUpdated) === null || _a$lastUpdated === void 0 ? void 0 : _a$lastUpdated.seconds) || 0);\n      });\n      setConversations(fetchedConversations);\n      if (!currentConversationId && fetchedConversations.length > 0) {\n        setCurrentConversationId(fetchedConversations[0].id);\n      } else if (fetchedConversations.length === 0) {\n        setCurrentConversationId(null);\n        setMessages([]);\n      }\n    }, firestoreError => {\n      setError(`Failed to load conversations: ${firestoreError.message}`);\n      console.error(\"Firestore conversations error:\", firestoreError);\n    });\n    return () => unsubscribe();\n  }, [db, user, isAuthReady, appId, currentConversationId]);\n\n  // 4. Fetch messages for the current conversation.\n  useEffect(() => {\n    if (!db || !user || !currentConversationId) {\n      setMessages([]); // Clear messages if no conversation is selected\n      return;\n    }\n    const messagesCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations', currentConversationId, 'messages');\n    const unsubscribe = onSnapshot(messagesCollectionRef, querySnapshot => {\n      const fetchedMessages = [];\n      querySnapshot.forEach(doc => {\n        fetchedMessages.push({\n          id: doc.id,\n          ...doc.data()\n        });\n      });\n      fetchedMessages.sort((a, b) => {\n        var _a$timestamp, _b$timestamp;\n        return (((_a$timestamp = a.timestamp) === null || _a$timestamp === void 0 ? void 0 : _a$timestamp.seconds) || 0) - (((_b$timestamp = b.timestamp) === null || _b$timestamp === void 0 ? void 0 : _b$timestamp.seconds) || 0);\n      });\n      setMessages(fetchedMessages);\n    }, firestoreError => {\n      setError(`Failed to load messages for conversation: ${firestoreError.message}`);\n      console.error(\"Firestore messages error:\", firestoreError);\n    });\n    return () => unsubscribe();\n  }, [db, user, currentConversationId, appId]);\n\n  // 5. Start a new conversation.\n  const startNewChat = async () => {\n    if (!db || !user) {\n      setError(\"You must be logged in to start a new chat.\");\n      return;\n    }\n    setMessages([]);\n    setNewMessage('');\n    setSelectedImage(null);\n    setError(null);\n    setIsAIGenerating(false);\n    setIsSummarizing(false);\n    setIsGeneratingImage(false);\n    try {\n      const conversationsCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations');\n      const newConversationDocRef = doc(conversationsCollectionRef);\n      const newConvId = newConversationDocRef.id;\n      await setDoc(newConversationDocRef, {\n        title: 'New Chat',\n        createdAt: serverTimestamp(),\n        lastUpdated: serverTimestamp()\n      });\n      setCurrentConversationId(newConvId);\n      setIsSidebarOpen(false);\n      // Immediately focus the input after starting a new chat\n      setTimeout(() => {\n        var _inputRef$current;\n        (_inputRef$current = inputRef.current) === null || _inputRef$current === void 0 ? void 0 : _inputRef$current.focus();\n      }, 0);\n    } catch (e) {\n      setError(`Failed to create a new chat: ${e.message}`);\n      console.error(\"Error creating new conversation:\", e);\n    }\n  };\n\n  // 6. Handle sending a new message (and creating a new conversation if needed).\n  const handleSendMessage = async e => {\n    e.preventDefault();\n    if (!newMessage.trim() && !selectedImage || !user || !db || isAIGenerating || isSpeaking) return;\n    let conversationIdToUse = currentConversationId;\n    const userMessageText = newMessage;\n    const imageToSend = selectedImage;\n    setNewMessage('');\n    setSelectedImage(null);\n\n    // After sending the message, immediately refocus the input field\n    setTimeout(() => {\n      var _inputRef$current2;\n      (_inputRef$current2 = inputRef.current) === null || _inputRef$current2 === void 0 ? void 0 : _inputRef$current2.focus();\n    }, 0);\n    const command = userMessageText.toLowerCase().trim();\n\n    // If no conversation is active, create a new one.\n    if (!conversationIdToUse) {\n      const newConvId = generateId();\n      const conversationsCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations');\n      const newConversationDocRef = doc(conversationsCollectionRef, newConvId);\n      const initialTitle = userMessageText ? userMessageText.substring(0, 50) + (userMessageText.length > 50 ? '...' : '') : 'New chat with image';\n      try {\n        await setDoc(newConversationDocRef, {\n          title: initialTitle,\n          createdAt: serverTimestamp(),\n          lastUpdated: serverTimestamp()\n        });\n        conversationIdToUse = newConvId;\n        setCurrentConversationId(newConvId);\n      } catch (createError) {\n        setError(`Failed to create new conversation: ${createError.message}`);\n        console.error(\"Error creating new conversation:\", createError);\n        return;\n      }\n    } else {\n      // Otherwise, just update the lastUpdated timestamp of the current conversation.\n      const conversationDocRef = doc(db, 'artifacts', appId, 'users', user.uid, 'conversations', conversationIdToUse);\n      try {\n        await setDoc(conversationDocRef, {\n          lastUpdated: serverTimestamp()\n        }, {\n          merge: true\n        });\n      } catch (updateError) {\n        console.error(\"Error updating conversation timestamp:\", updateError);\n      }\n    }\n\n    // Add user message to Firestore\n    try {\n      const messagesCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations', conversationIdToUse, 'messages');\n      await addDoc(messagesCollectionRef, {\n        text: userMessageText,\n        userId: user.uid,\n        userName: `User_${user.uid.substring(0, 5)}`,\n        timestamp: serverTimestamp(),\n        type: 'user-message',\n        imageData: imageToSend\n      });\n    } catch (e) {\n      setError(`Failed to send message: ${e.message}`);\n      return;\n    }\n    if (imageToSend) {\n      handleImageAnalysis(userMessageText, imageToSend, conversationIdToUse);\n    } else if (command.startsWith('image of')) {\n      const imagePrompt = userMessageText.substring('image of'.length).trim();\n      handleGenerateImage(imagePrompt, conversationIdToUse);\n    } else {\n      handleAIResponse(userMessageText, conversationIdToUse);\n    }\n  };\n\n  // Function to handle image upload\n  const handleImageUpload = event => {\n    const file = event.target.files[0];\n    if (file) {\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        setSelectedImage(reader.result);\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  // 7. Handle sending the sign-in email link.\n  const handleSendSignInLink = async e => {\n    e.preventDefault();\n    if (!auth || !email.trim()) {\n      setError(\"Please enter a valid email address.\");\n      return;\n    }\n    setLoading(true);\n    setError(null);\n    const actionCodeSettings = {\n      url: window.location.origin,\n      handleCodeInApp: true\n    };\n    try {\n      await sendSignInLinkToEmail(auth, email, actionCodeSettings);\n      setEmailSent(true);\n      window.localStorage.setItem('emailForSignIn', email);\n      setLoading(false);\n    } catch (error) {\n      setError(`Failed to send sign-in link: ${error.message}`);\n      setLoading(false);\n    }\n  };\n\n  // 8. Handle Email/Password Registration\n  const handleEmailPasswordSignUp = async e => {\n    e.preventDefault();\n    if (!auth || !email.trim() || !password.trim()) {\n      setError(\"Please enter a valid email and password.\");\n      return;\n    }\n    setLoading(true);\n    setError(null);\n    try {\n      await createUserWithEmailAndPassword(auth, email, password);\n      setEmail('');\n      setPassword('');\n      setLoading(false);\n    } catch (error) {\n      setError(`Failed to sign up: ${error.message}`);\n      setLoading(false);\n    }\n  };\n\n  // 9. Handle Email/Password Login\n  const handleEmailPasswordSignIn = async e => {\n    e.preventDefault();\n    if (!auth || !email.trim() || !password.trim()) {\n      setError(\"Please enter a valid email and password.\");\n      return;\n    }\n    setLoading(true);\n    setError(null);\n    try {\n      await signInWithEmailAndPassword(auth, email, password);\n      setEmail('');\n      setPassword('');\n      setLoading(false);\n    } catch (error) {\n      setError(`Failed to sign in: ${error.message}`);\n      setLoading(false);\n    }\n  };\n\n  // 10. Handle sign-out.\n  const handleSignOut = async () => {\n    if (!auth) return;\n    try {\n      await signOut(auth);\n      // Reset states\n      setUser(null);\n      setConversations([]);\n      setMessages([]);\n      setCurrentConversationId(null);\n      setError(null);\n    } catch (error) {\n      setError(`Failed to sign out: ${error.message}`);\n      console.error(\"Sign out error:\", error);\n    }\n  };\n\n  // 11. Handle AI response using Gemini API.\n  const handleAIResponse = async (userPrompt, conversationId) => {\n    if (!user || !db || !conversationId) return;\n    setIsAIGenerating(true);\n    let promptText = userPrompt;\n    let newMessages = [...messages];\n    const messagesCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations', conversationId, 'messages');\n\n    // Get the conversation history to provide context to the AI\n    let chatHistory = [];\n    try {\n      const q = query(messagesCollectionRef, limit(20));\n      const querySnapshot = await getDocs(q);\n      querySnapshot.forEach(doc => {\n        const data = doc.data();\n        if (data.type === 'user-message') {\n          chatHistory.push({\n            role: 'user',\n            parts: [{\n              text: data.text\n            }]\n          });\n        } else if (data.type === 'ai-message') {\n          chatHistory.push({\n            role: 'model',\n            parts: [{\n              text: data.text\n            }]\n          });\n        }\n      });\n      // Add the latest user prompt\n      chatHistory.push({\n        role: \"user\",\n        parts: [{\n          text: promptText\n        }]\n      });\n    } catch (e) {\n      console.error(\"Error fetching chat history:\", e);\n      // If fetching history fails, just use the current prompt\n      chatHistory = [{\n        role: \"user\",\n        parts: [{\n          text: promptText\n        }]\n      }];\n    }\n    const payload = {\n      contents: chatHistory,\n      generationConfig: {\n        temperature: generationSettings.temperature,\n        topK: generationSettings.topK,\n        topP: generationSettings.topP\n      },\n      systemInstruction: systemInstruction ? {\n        parts: [{\n          text: systemInstruction\n        }]\n      } : undefined\n    };\n    const apiKey = \"\";\n    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;\n    try {\n      var _result$candidates, _result$candidates$, _result$candidates$$c, _result$candidates$$c2, _result$candidates$$c3;\n      const response = await fetchWithExponentialBackoff(apiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload)\n      });\n      const result = await response.json();\n      const aiResponseText = ((_result$candidates = result.candidates) === null || _result$candidates === void 0 ? void 0 : (_result$candidates$ = _result$candidates[0]) === null || _result$candidates$ === void 0 ? void 0 : (_result$candidates$$c = _result$candidates$.content) === null || _result$candidates$$c === void 0 ? void 0 : (_result$candidates$$c2 = _result$candidates$$c.parts) === null || _result$candidates$$c2 === void 0 ? void 0 : (_result$candidates$$c3 = _result$candidates$$c2[0]) === null || _result$candidates$$c3 === void 0 ? void 0 : _result$candidates$$c3.text) || 'No response from AI.';\n\n      // Add AI response to Firestore\n      await addDoc(messagesCollectionRef, {\n        text: aiResponseText,\n        userId: 'ai',\n        userName: 'Gemini',\n        timestamp: serverTimestamp(),\n        type: 'ai-message'\n      });\n    } catch (e) {\n      console.error(\"Gemini API error:\", e);\n      setError(`Gemini API error: ${e.message}`);\n    } finally {\n      setIsAIGenerating(false);\n    }\n  };\n\n  // 12. Handle image analysis with Gemini Vision API\n  const handleImageAnalysis = async (userPrompt, imageData, conversationId) => {\n    if (!user || !db || !conversationId) return;\n    setIsAIGenerating(true);\n    const messagesCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations', conversationId, 'messages');\n\n    // Remove the data URL prefix \"data:image/png;base64,\"\n    const base64ImageData = imageData.split(',')[1];\n    const payload = {\n      contents: [{\n        role: \"user\",\n        parts: [{\n          text: userPrompt || 'What is in this image?'\n        }, {\n          inlineData: {\n            mimeType: \"image/png\",\n            // Assuming PNG, but should be dynamic if possible\n            data: base64ImageData\n          }\n        }]\n      }]\n    };\n    const apiKey = \"\";\n    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;\n    try {\n      var _result$candidates2, _result$candidates2$, _result$candidates2$$, _result$candidates2$$2, _result$candidates2$$3;\n      const response = await fetchWithExponentialBackoff(apiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload)\n      });\n      const result = await response.json();\n      const aiResponseText = ((_result$candidates2 = result.candidates) === null || _result$candidates2 === void 0 ? void 0 : (_result$candidates2$ = _result$candidates2[0]) === null || _result$candidates2$ === void 0 ? void 0 : (_result$candidates2$$ = _result$candidates2$.content) === null || _result$candidates2$$ === void 0 ? void 0 : (_result$candidates2$$2 = _result$candidates2$$.parts) === null || _result$candidates2$$2 === void 0 ? void 0 : (_result$candidates2$$3 = _result$candidates2$$2[0]) === null || _result$candidates2$$3 === void 0 ? void 0 : _result$candidates2$$3.text) || 'No response from AI.';\n\n      // Add AI response to Firestore\n      await addDoc(messagesCollectionRef, {\n        text: aiResponseText,\n        userId: 'ai',\n        userName: 'Gemini',\n        timestamp: serverTimestamp(),\n        type: 'ai-message'\n      });\n    } catch (e) {\n      console.error(\"Gemini Vision API error:\", e);\n      setError(`Gemini Vision API error: ${e.message}`);\n    } finally {\n      setIsAIGenerating(false);\n    }\n  };\n\n  // 13. Handle image generation with Imagen API\n  const handleGenerateImage = async (imagePrompt, conversationId) => {\n    if (!user || !db || !conversationId) return;\n    setIsGeneratingImage(true);\n    const messagesCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations', conversationId, 'messages');\n    const payload = {\n      instances: {\n        prompt: imagePrompt\n      },\n      parameters: {\n        \"sampleCount\": 1\n      }\n    };\n    const apiKey = \"\";\n    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;\n    try {\n      var _result$predictions, _result$predictions$;\n      const response = await fetchWithExponentialBackoff(apiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload)\n      });\n      const result = await response.json();\n      const base64Data = (_result$predictions = result.predictions) === null || _result$predictions === void 0 ? void 0 : (_result$predictions$ = _result$predictions[0]) === null || _result$predictions$ === void 0 ? void 0 : _result$predictions$.bytesBase64Encoded;\n      if (base64Data) {\n        const imageUrl = `data:image/png;base64,${base64Data}`;\n        // Add AI response to Firestore, including the image data\n        await addDoc(messagesCollectionRef, {\n          text: 'Generated Image',\n          userId: 'ai',\n          userName: 'Gemini',\n          timestamp: serverTimestamp(),\n          type: 'image-message',\n          imageData: imageUrl\n        });\n      } else {\n        throw new Error(\"No image data received from the API.\");\n      }\n    } catch (e) {\n      console.error(\"Imagen API error:\", e);\n      setError(`Imagen API error: ${e.message}`);\n    } finally {\n      setIsGeneratingImage(false);\n    }\n  };\n\n  // 14. Handle Text-to-Speech\n  const handleTTS = async (text, messageId, languageCode = 'en-US') => {\n    setIsSpeaking(true);\n    currentAudioIdRef.current = messageId;\n    const ttsVoice = prebuiltVoices.includes(voiceName) ? voiceName : 'Kore'; // Use Kore as default if voiceName is not valid\n    const payload = {\n      contents: [{\n        parts: [{\n          text: `Say in ${languageCode}: ${text}`\n        }]\n      }],\n      generationConfig: {\n        responseModalities: [\"AUDIO\"],\n        speechConfig: {\n          voiceConfig: {\n            prebuiltVoiceConfig: {\n              voiceName: ttsVoice\n            }\n          }\n        }\n      },\n      model: \"gemini-2.5-flash-preview-tts\"\n    };\n    const apiKey = \"\";\n    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;\n    try {\n      var _result$candidates3, _result$candidates3$, _result$candidates3$$, _result$candidates3$$2, _part$inlineData, _part$inlineData2;\n      const response = await fetchWithExponentialBackoff(apiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload)\n      });\n      const result = await response.json();\n      const part = result === null || result === void 0 ? void 0 : (_result$candidates3 = result.candidates) === null || _result$candidates3 === void 0 ? void 0 : (_result$candidates3$ = _result$candidates3[0]) === null || _result$candidates3$ === void 0 ? void 0 : (_result$candidates3$$ = _result$candidates3$.content) === null || _result$candidates3$$ === void 0 ? void 0 : (_result$candidates3$$2 = _result$candidates3$$.parts) === null || _result$candidates3$$2 === void 0 ? void 0 : _result$candidates3$$2[0];\n      const audioData = part === null || part === void 0 ? void 0 : (_part$inlineData = part.inlineData) === null || _part$inlineData === void 0 ? void 0 : _part$inlineData.data;\n      const mimeType = part === null || part === void 0 ? void 0 : (_part$inlineData2 = part.inlineData) === null || _part$inlineData2 === void 0 ? void 0 : _part$inlineData2.mimeType;\n      if (audioData && mimeType && mimeType.startsWith(\"audio/L16\")) {\n        const sampleRate = parseInt(mimeType.match(/rate=(\\d+)/)[1], 10);\n        const pcmData = base64ToArrayBuffer(audioData);\n        const wavBlob = pcmToWav(pcmData, sampleRate);\n        const audioUrl = URL.createObjectURL(wavBlob);\n        if (audioRef.current) {\n          audioRef.current.src = audioUrl;\n          audioRef.current.play();\n          audioRef.current.onended = () => {\n            URL.revokeObjectURL(audioUrl);\n            setIsSpeaking(false);\n            currentAudioIdRef.current = null;\n          };\n        }\n      } else {\n        throw new Error('Invalid audio data received from API.');\n      }\n    } catch (e) {\n      console.error(\"TTS API error:\", e);\n      setError(`TTS API error: ${e.message}`);\n      setIsSpeaking(false);\n      currentAudioIdRef.current = null;\n    }\n  };\n\n  // 15. Handle creative writing\n  const handleCreativeWriting = async (topic, style, tone, conversationId) => {\n    if (!user || !db || !conversationId) return;\n    setIsAIGenerating(true);\n    const messagesCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations', conversationId, 'messages');\n    const prompt = `Write a ${style} about the topic: \"${topic}\". The tone should be ${tone}.`;\n    let chatHistory = [];\n    chatHistory.push({\n      role: \"user\",\n      parts: [{\n        text: prompt\n      }]\n    });\n    const payload = {\n      contents: chatHistory,\n      generationConfig: {\n        temperature: 0.9,\n        topK: 40,\n        topP: 0.95\n      }\n    };\n    const apiKey = \"\";\n    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;\n    try {\n      var _result$candidates4, _result$candidates4$, _result$candidates4$$, _result$candidates4$$2, _result$candidates4$$3;\n      const response = await fetchWithExponentialBackoff(apiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload)\n      });\n      const result = await response.json();\n      const aiResponseText = ((_result$candidates4 = result.candidates) === null || _result$candidates4 === void 0 ? void 0 : (_result$candidates4$ = _result$candidates4[0]) === null || _result$candidates4$ === void 0 ? void 0 : (_result$candidates4$$ = _result$candidates4$.content) === null || _result$candidates4$$ === void 0 ? void 0 : (_result$candidates4$$2 = _result$candidates4$$.parts) === null || _result$candidates4$$2 === void 0 ? void 0 : (_result$candidates4$$3 = _result$candidates4$$2[0]) === null || _result$candidates4$$3 === void 0 ? void 0 : _result$candidates4$$3.text) || 'No response from AI.';\n      await addDoc(messagesCollectionRef, {\n        text: aiResponseText,\n        userId: 'ai',\n        userName: 'Gemini',\n        timestamp: serverTimestamp(),\n        type: 'ai-message'\n      });\n    } catch (e) {\n      console.error(\"Creative Writing API error:\", e);\n      setError(`Creative Writing API error: ${e.message}`);\n    } finally {\n      setIsAIGenerating(false);\n      setShowCreativeWriterModal(false);\n    }\n  };\n\n  // 16. Handle text translation\n  const handleTranslateText = async (text, language, conversationId) => {\n    if (!user || !db || !conversationId) return;\n    setIsAIGenerating(true);\n    const messagesCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations', conversationId, 'messages');\n    const prompt = `Translate the following text to ${language}: \"${text}\"`;\n    let chatHistory = [];\n    chatHistory.push({\n      role: \"user\",\n      parts: [{\n        text: prompt\n      }]\n    });\n    const payload = {\n      contents: chatHistory,\n      generationConfig: {\n        temperature: 0.1,\n        topK: 1,\n        topP: 0.9\n      }\n    };\n    const apiKey = \"\";\n    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;\n    try {\n      var _result$candidates5, _result$candidates5$, _result$candidates5$$, _result$candidates5$$2, _result$candidates5$$3;\n      const response = await fetchWithExponentialBackoff(apiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload)\n      });\n      const result = await response.json();\n      const aiResponseText = ((_result$candidates5 = result.candidates) === null || _result$candidates5 === void 0 ? void 0 : (_result$candidates5$ = _result$candidates5[0]) === null || _result$candidates5$ === void 0 ? void 0 : (_result$candidates5$$ = _result$candidates5$.content) === null || _result$candidates5$$ === void 0 ? void 0 : (_result$candidates5$$2 = _result$candidates5$$.parts) === null || _result$candidates5$$2 === void 0 ? void 0 : (_result$candidates5$$3 = _result$candidates5$$2[0]) === null || _result$candidates5$$3 === void 0 ? void 0 : _result$candidates5$$3.text) || 'No response from AI.';\n      await addDoc(messagesCollectionRef, {\n        text: aiResponseText,\n        userId: 'ai',\n        userName: 'Gemini',\n        timestamp: serverTimestamp(),\n        type: 'ai-message'\n      });\n    } catch (e) {\n      console.error(\"Translation API error:\", e);\n      setError(`Translation API error: ${e.message}`);\n    } finally {\n      setIsAIGenerating(false);\n      setShowGeminiModal(false);\n    }\n  };\n\n  // 17. Handle text continuation\n  const handleContinueText = async (text, conversationId) => {\n    if (!user || !db || !conversationId) return;\n    setIsAIGenerating(true);\n    const messagesCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations', conversationId, 'messages');\n    const prompt = `Continue the following text: \"${text}\"`;\n    let chatHistory = [];\n    chatHistory.push({\n      role: \"user\",\n      parts: [{\n        text: prompt\n      }]\n    });\n    const payload = {\n      contents: chatHistory,\n      generationConfig: {\n        temperature: 0.9,\n        topK: 40,\n        topP: 0.95\n      }\n    };\n    const apiKey = \"AIzaSyCBBfnCqQlfrOCmSPzNuyC8F4jT0OHUX7g\";\n    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;\n    try {\n      var _result$candidates6, _result$candidates6$, _result$candidates6$$, _result$candidates6$$2, _result$candidates6$$3;\n      const response = await fetchWithExponentialBackoff(apiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload)\n      });\n      const result = await response.json();\n      const aiResponseText = ((_result$candidates6 = result.candidates) === null || _result$candidates6 === void 0 ? void 0 : (_result$candidates6$ = _result$candidates6[0]) === null || _result$candidates6$ === void 0 ? void 0 : (_result$candidates6$$ = _result$candidates6$.content) === null || _result$candidates6$$ === void 0 ? void 0 : (_result$candidates6$$2 = _result$candidates6$$.parts) === null || _result$candidates6$$2 === void 0 ? void 0 : (_result$candidates6$$3 = _result$candidates6$$2[0]) === null || _result$candidates6$$3 === void 0 ? void 0 : _result$candidates6$$3.text) || 'No response from AI.';\n      await addDoc(messagesCollectionRef, {\n        text: aiResponseText,\n        userId: 'ai',\n        userName: 'Gemini',\n        timestamp: serverTimestamp(),\n        type: 'ai-message'\n      });\n    } catch (e) {\n      console.error(\"Text Continuation API error:\", e);\n      setError(`Text Continuation API error: ${e.message}`);\n    } finally {\n      setIsAIGenerating(false);\n      setShowGeminiModal(false);\n    }\n  };\n\n  // 18. Handle message summarizing\n  const handleSummarizeConversation = async () => {\n    if (!user || !db || !currentConversationId) return;\n    setIsSummarizing(true);\n    const messagesCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations', currentConversationId, 'messages');\n\n    // Get the conversation history to provide context to the AI\n    let chatHistory = [];\n    try {\n      const q = query(messagesCollectionRef, limit(20));\n      const querySnapshot = await getDocs(q);\n      querySnapshot.forEach(doc => {\n        const data = doc.data();\n        chatHistory.push({\n          role: data.type === 'user-message' ? 'user' : 'model',\n          parts: [{\n            text: data.text\n          }]\n        });\n      });\n    } catch (e) {\n      console.error(\"Error fetching chat history:\", e);\n      setError(`Error fetching chat history for summarization: ${e.message}`);\n      setIsSummarizing(false);\n      return;\n    }\n    const prompt = `Summarize the following conversation.`;\n    chatHistory.push({\n      role: \"user\",\n      parts: [{\n        text: prompt\n      }]\n    });\n    const payload = {\n      contents: chatHistory,\n      generationConfig: {\n        temperature: 0.2,\n        // Lower temperature for factual summary\n        topK: 1,\n        topP: 0.9\n      }\n    };\n    const apiKey = \"AIzaSyCBBfnCqQlfrOCmSPzNuyC8F4jT0OHUX7g\";\n    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;\n    try {\n      var _result$candidates7, _result$candidates7$, _result$candidates7$$, _result$candidates7$$2, _result$candidates7$$3;\n      const response = await fetchWithExponentialBackoff(apiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload)\n      });\n      const result = await response.json();\n      const summaryText = ((_result$candidates7 = result.candidates) === null || _result$candidates7 === void 0 ? void 0 : (_result$candidates7$ = _result$candidates7[0]) === null || _result$candidates7$ === void 0 ? void 0 : (_result$candidates7$$ = _result$candidates7$.content) === null || _result$candidates7$$ === void 0 ? void 0 : (_result$candidates7$$2 = _result$candidates7$$.parts) === null || _result$candidates7$$2 === void 0 ? void 0 : (_result$candidates7$$3 = _result$candidates7$$2[0]) === null || _result$candidates7$$3 === void 0 ? void 0 : _result$candidates7$$3.text) || 'Could not generate a summary.';\n      const conversationDocRef = doc(db, 'artifacts', appId, 'users', user.uid, 'conversations', currentConversationId);\n      await setDoc(conversationDocRef, {\n        title: summaryText\n      }, {\n        merge: true\n      });\n    } catch (e) {\n      console.error(\"Summarization API error:\", e);\n      setError(`Summarization API error: ${e.message}`);\n    } finally {\n      setIsSummarizing(false);\n    }\n  };\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex items-center justify-center h-screen bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100\",\n      children: /*#__PURE__*/_jsxDEV(LoaderCircle, {\n        className: \"h-10 w-10 animate-spin text-indigo-500\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1012,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1011,\n      columnNumber: 7\n    }, this);\n  }\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex flex-col items-center justify-center h-screen bg-red-50 dark:bg-red-900 text-red-800 dark:text-red-200 p-4\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        className: \"text-xl font-bold mb-4\",\n        children: \"An error occurred\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1020,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-center\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1021,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => window.location.reload(),\n        className: \"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors\",\n        children: \"Reload App\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1022,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1019,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex h-screen bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 overflow-hidden\",\n    children: [/*#__PURE__*/_jsxDEV(\"aside\", {\n      className: `bg-white dark:bg-gray-800 shadow-lg p-6 flex flex-col transition-transform duration-300 ease-in-out ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} fixed inset-y-0 left-0 w-64 z-40 lg:relative lg:translate-x-0`,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-1 overflow-y-auto\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center justify-between mb-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-2xl font-bold\",\n            children: \"Chats\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1039,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setIsSidebarOpen(!isSidebarOpen),\n            className: \"p-2 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700 lg:hidden\",\n            children: /*#__PURE__*/_jsxDEV(X, {\n              className: \"h-5 w-5\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1044,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1040,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1038,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: startNewChat,\n          className: \"w-full bg-indigo-500 text-white p-3 rounded-lg shadow-md hover:bg-indigo-600 transition-colors duration-200 mb-4 flex items-center justify-center\",\n          disabled: isAIGenerating,\n          children: [/*#__PURE__*/_jsxDEV(Plus, {\n            className: \"h-5 w-5 mr-2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1052,\n            columnNumber: 13\n          }, this), \" New Chat\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1047,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          className: \"space-y-2\",\n          children: conversations.map(conv => /*#__PURE__*/_jsxDEV(\"li\", {\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => {\n                setCurrentConversationId(conv.id);\n                setIsSidebarOpen(false); // Close sidebar on mobile after selection\n              },\n              className: `w-full text-left p-3 rounded-lg transition-colors duration-200 ${conv.id === currentConversationId ? 'bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-100 font-semibold' : 'hover:bg-gray-200 dark:hover:bg-gray-700'}`,\n              children: conv.title\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1057,\n              columnNumber: 17\n            }, this)\n          }, conv.id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1056,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1054,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1037,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-between items-center mb-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-sm font-medium\",\n            children: \"User ID:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1076,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-xs break-all\",\n            children: user === null || user === void 0 ? void 0 : user.uid\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1077,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1075,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleSignOut,\n          className: \"w-full text-left p-3 text-red-500 hover:bg-red-100 dark:hover:bg-red-900 rounded-lg transition-colors duration-200 flex items-center justify-center\",\n          children: \"Sign Out\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1079,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1074,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1032,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n      className: \"flex-1 flex flex-col\",\n      children: [/*#__PURE__*/_jsxDEV(\"header\", {\n        className: \"bg-white dark:bg-gray-800 shadow-md p-4 flex items-center justify-between lg:hidden\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setIsSidebarOpen(true),\n          className: \"p-2 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700\",\n          children: /*#__PURE__*/_jsxDEV(Menu, {\n            className: \"h-6 w-6\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1096,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1092,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n          className: \"text-xl font-bold truncate flex-1 text-center\",\n          children: ((_conversations$find = conversations.find(c => c.id === currentConversationId)) === null || _conversations$find === void 0 ? void 0 : _conversations$find.title) || 'New Chat'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1098,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => startNewChat(),\n          className: \"p-2 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700\",\n          disabled: isAIGenerating,\n          children: /*#__PURE__*/_jsxDEV(Plus, {\n            className: \"h-6 w-6\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1106,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1101,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1091,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-1 overflow-y-auto p-6 space-y-6\",\n        children: [messages.length === 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex flex-col items-center justify-center h-full text-gray-400 dark:text-gray-600\",\n          children: [/*#__PURE__*/_jsxDEV(Sparkles, {\n            className: \"h-16 w-16 mb-4\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1114,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-xl font-semibold\",\n            children: \"Start a new conversation\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1115,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1113,\n          columnNumber: 13\n        }, this), messages.map((msg, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `flex items-start space-x-4 ${msg.type === 'user-message' ? 'justify-end' : 'justify-start'}`,\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `p-4 rounded-xl shadow-sm ${msg.type === 'user-message' ? 'bg-indigo-500 text-white rounded-br-none' : 'bg-white dark:bg-gray-800 rounded-bl-none'}`,\n            children: [msg.type === 'image-message' && msg.imageData ? /*#__PURE__*/_jsxDEV(\"img\", {\n              src: msg.imageData,\n              alt: \"Generated\",\n              className: \"max-w-xs rounded-lg\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1133,\n              columnNumber: 19\n            }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n              dangerouslySetInnerHTML: {\n                __html: marked(msg.text || '')\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1135,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex justify-end items-center mt-2\",\n              children: msg.type === 'ai-message' && /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: () => {\n                    if (currentAudioIdRef.current === msg.id) {\n                      var _audioRef$current;\n                      (_audioRef$current = audioRef.current) === null || _audioRef$current === void 0 ? void 0 : _audioRef$current.pause();\n                      setIsSpeaking(false);\n                      currentAudioIdRef.current = null;\n                    } else {\n                      handleTTS(msg.text, msg.id);\n                    }\n                  },\n                  className: `p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 ${currentAudioIdRef.current === msg.id ? 'text-indigo-500' : 'text-gray-500'}`,\n                  disabled: isSpeaking && currentAudioIdRef.current !== msg.id,\n                  children: isSpeaking && currentAudioIdRef.current === msg.id ? /*#__PURE__*/_jsxDEV(Pause, {\n                    className: \"h-4 w-4\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1153,\n                    columnNumber: 79\n                  }, this) : /*#__PURE__*/_jsxDEV(Volume2, {\n                    className: \"h-4 w-4\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1153,\n                    columnNumber: 111\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1140,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1137,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1125,\n            columnNumber: 15\n          }, this)\n        }, msg.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1119,\n          columnNumber: 13\n        }, this)), (isAIGenerating || isSummarizing || isGeneratingImage) && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-start space-x-4\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"p-4 rounded-xl shadow-sm bg-white dark:bg-gray-800 rounded-bl-none\",\n            children: /*#__PURE__*/_jsxDEV(LoaderCircle, {\n              className: \"h-6 w-6 animate-spin text-indigo-500\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1164,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1163,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1162,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: messagesEndRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1168,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1111,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white dark:bg-gray-800 shadow-inner p-4\",\n        children: [selectedImage && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mb-4 relative w-24 h-24\",\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: selectedImage,\n            alt: \"Selected\",\n            className: \"w-full h-full object-cover rounded-lg\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1175,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setSelectedImage(null),\n            className: \"absolute top-1 right-1 p-1 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-75\",\n            children: /*#__PURE__*/_jsxDEV(X, {\n              className: \"h-4 w-4\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1180,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1176,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1174,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n          onSubmit: handleSendMessage,\n          className: \"flex items-center space-x-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"file-upload\",\n            className: \"cursor-pointer p-3 text-gray-500 hover:text-indigo-500 transition-colors duration-200\",\n            children: /*#__PURE__*/_jsxDEV(Image, {\n              className: \"h-6 w-6\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1186,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1185,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            id: \"file-upload\",\n            type: \"file\",\n            onChange: handleImageUpload,\n            className: \"hidden\",\n            accept: \"image/*\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1188,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            onClick: () => setShowCreativeWriterModal(true),\n            className: \"p-3 text-gray-500 hover:text-indigo-500 transition-colors duration-200\",\n            children: /*#__PURE__*/_jsxDEV(PenTool, {\n              className: \"h-6 w-6\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1195,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1190,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            onClick: () => handleSummarizeConversation(),\n            className: \"p-3 text-gray-500 hover:text-indigo-500 transition-colors duration-200\",\n            disabled: isSummarizing || !currentConversationId,\n            title: \"Summarize current conversation\",\n            children: /*#__PURE__*/_jsxDEV(MessageSquareMore, {\n              className: \"h-6 w-6\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1205,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1198,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            onClick: () => setShowGeminiModal(true),\n            className: \"p-3 text-gray-500 hover:text-indigo-500 transition-colors duration-200\",\n            children: /*#__PURE__*/_jsxDEV(Sparkles, {\n              className: \"h-6 w-6\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1213,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1208,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            ref: inputRef // Added the ref here\n            ,\n            value: newMessage,\n            onChange: e => setNewMessage(e.target.value),\n            placeholder: \"Type a message...\",\n            className: \"flex-1 p-3 border border-gray-300 dark:border-gray-600 rounded-full bg-gray-50 dark:bg-gray-800 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500\",\n            disabled: isAIGenerating || isSpeaking\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1216,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            className: \"p-3 bg-indigo-500 text-white rounded-full shadow-md hover:bg-indigo-600 transition-colors duration-200\",\n            disabled: isAIGenerating || isSpeaking,\n            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n              xmlns: \"http://www.w3.org/2000/svg\",\n              width: \"24\",\n              height: \"24\",\n              viewBox: \"0 0 24 24\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              strokeWidth: \"2\",\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\",\n              className: \"lucide lucide-send-horizontal\",\n              children: [/*#__PURE__*/_jsxDEV(\"path\", {\n                d: \"m3 3 3 9-3 9 19-9Z\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1230,\n                columnNumber: 235\n              }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n                d: \"M6 12h16\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1230,\n                columnNumber: 265\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1230,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1225,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1184,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1172,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1089,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"audio\", {\n      ref: audioRef,\n      className: \"hidden\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1237,\n      columnNumber: 7\n    }, this), showCreativeWriterModal && /*#__PURE__*/createPortal(/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white dark:bg-gray-900 rounded-xl shadow-lg p-6 w-full max-w-md mx-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-between items-center mb-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-xl font-bold\",\n            children: \"Creative Writer\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1244,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setShowCreativeWriterModal(false),\n            className: \"p-1 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700\",\n            children: /*#__PURE__*/_jsxDEV(X, {\n              className: \"h-5 w-5\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1246,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1245,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1243,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"space-y-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\",\n              children: \"Topic\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1251,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              value: creativeTopic,\n              onChange: e => setCreativeTopic(e.target.value),\n              className: \"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500\",\n              placeholder: \"e.g., A journey through a forest\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1252,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1250,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\",\n              children: \"Style\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1262,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n              value: creativeStyle,\n              onChange: e => setCreativeStyle(e.target.value),\n              className: \"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500\",\n              children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"Poem\",\n                children: \"Poem\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1268,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"Short Story\",\n                children: \"Short Story\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1269,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"Blog Post\",\n                children: \"Blog Post\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1270,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"News Article\",\n                children: \"News Article\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1271,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1263,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1261,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\",\n              children: \"Tone\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1276,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n              value: creativeTone,\n              onChange: e => setCreativeTone(e.target.value),\n              className: \"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500\",\n              children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"Neutral\",\n                children: \"Neutral\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1282,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"Happy\",\n                children: \"Happy\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1283,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"Sad\",\n                children: \"Sad\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1284,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"Excited\",\n                children: \"Excited\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1285,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"Mysterious\",\n                children: \"Mysterious\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1286,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1277,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1275,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => handleCreativeWriting(creativeTopic, creativeStyle, creativeTone, currentConversationId),\n            className: \"w-full bg-indigo-500 text-white p-3 rounded-lg shadow-md hover:bg-indigo-600 transition-colors duration-200 mt-4\",\n            disabled: isAIGenerating || !creativeTopic,\n            children: \"Generate\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1290,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1249,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1242,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1241,\n      columnNumber: 9\n    }, this), document.body), showGeminiModal && /*#__PURE__*/createPortal(/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white dark:bg-gray-900 rounded-xl shadow-lg p-6 w-full max-w-md mx-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-between items-center mb-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-xl font-bold\",\n            children: \"Gemini Features\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1308,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setShowGeminiModal(false),\n            className: \"p-1 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700\",\n            children: /*#__PURE__*/_jsxDEV(X, {\n              className: \"h-5 w-5\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1310,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1309,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1307,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"space-y-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              className: \"text-lg font-semibold mb-2\",\n              children: \"Continue Text\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1315,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n              value: textToContinue,\n              onChange: e => setTextToContinue(e.target.value),\n              className: \"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500\",\n              placeholder: \"Enter text to continue...\",\n              rows: \"3\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1316,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => handleContinueText(textToContinue, currentConversationId),\n              className: \"w-full bg-indigo-500 text-white p-3 rounded-lg shadow-md hover:bg-indigo-600 transition-colors duration-200 mt-2\",\n              disabled: isAIGenerating || !textToContinue,\n              children: \"Continue\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1323,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1314,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              className: \"text-lg font-semibold mb-2\",\n              children: \"Translate Text\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1332,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n              value: textToTranslate,\n              onChange: e => setTextToTranslate(e.target.value),\n              className: \"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500\",\n              placeholder: \"Enter text to translate...\",\n              rows: \"3\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1333,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n              value: translationTargetLanguage,\n              onChange: e => setTranslationTargetLanguage(e.target.value),\n              className: \"w-full p-3 mt-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500\",\n              children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"en-US\",\n                children: \"English\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1345,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"es-US\",\n                children: \"Spanish\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1346,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"fr-FR\",\n                children: \"French\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1347,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"de-DE\",\n                children: \"German\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1348,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"ja-JP\",\n                children: \"Japanese\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1349,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"zh-CN\",\n                children: \"Chinese\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1350,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1340,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => handleTranslateText(textToTranslate, translationTargetLanguage, currentConversationId),\n              className: \"w-full bg-indigo-500 text-white p-3 rounded-lg shadow-md hover:bg-indigo-600 transition-colors duration-200 mt-2\",\n              disabled: isAIGenerating || !textToTranslate,\n              children: \"Translate\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1352,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1331,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1313,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1306,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1305,\n      columnNumber: 9\n    }, this), document.body), showSettingsModal && /*#__PURE__*/createPortal(/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white dark:bg-gray-900 rounded-xl shadow-lg p-6 w-full max-w-md mx-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-between items-center mb-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-xl font-bold\",\n            children: \"App Settings\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1371,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setShowSettingsModal(false),\n            className: \"p-1 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700\",\n            children: /*#__PURE__*/_jsxDEV(X, {\n              className: \"h-5 w-5\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1373,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1372,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1370,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"space-y-4\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              className: \"text-lg font-semibold mb-2\",\n              children: \"TTS Settings\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1378,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\",\n              children: \"Voice\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1379,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n              value: voiceName,\n              onChange: e => setVoiceName(e.target.value),\n              className: \"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500\",\n              children: prebuiltVoices.map(voice => /*#__PURE__*/_jsxDEV(\"option\", {\n                value: voice,\n                children: voice\n              }, voice, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1386,\n                columnNumber: 21\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1380,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1377,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1376,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1369,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1368,\n      columnNumber: 9\n    }, this), document.body)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1030,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"ukyFQUKhw0bGr286wlP0AeWx958=\");\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["useState","useEffect","useRef","initializeApp","getAuth","signInWithCustomToken","signInAnonymously","onAuthStateChanged","sendSignInLinkToEmail","isSignInWithEmailLink","signInWithEmailLink","createUserWithEmailAndPassword","signInWithEmailAndPassword","signOut","getFirestore","collection","onSnapshot","addDoc","serverTimestamp","doc","setDoc","query","limit","getDocs","marked","createPortal","Sparkles","MessageSquareMore","Image","LoaderCircle","X","ExternalLink","Menu","Plus","Play","Pause","Mic","Settings","Volume2","PenTool","jsxDEV","_jsxDEV","Fragment","_Fragment","localFirebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","firebaseConfig","__firebase_config","JSON","parse","__app_id","initialAuthToken","__initial_auth_token","generateId","replace","c","r","Math","random","v","toString","base64ToArrayBuffer","base64","binaryString","window","atob","len","length","bytes","Uint8Array","i","charCodeAt","buffer","pcmToWav","pcmData","sampleRate","pcm16","Int16Array","ArrayBuffer","view","DataView","writeString","offset","string","setUint8","setUint32","setUint16","setInt16","Blob","type","prebuiltVoices","App","_s","_conversations$find","db","setDb","auth","setAuth","isAuthReady","setIsAuthReady","user","setUser","loading","setLoading","error","setError","messages","setMessages","newMessage","setNewMessage","email","setEmail","password","setPassword","emailSent","setEmailSent","isSigningInWithLink","setIsSigningInWithLink","isAIGenerating","setIsAIGenerating","authMode","setAuthMode","conversations","setConversations","currentConversationId","setCurrentConversationId","isSidebarOpen","setIsSidebarOpen","isSummarizing","setIsSummarizing","isGeneratingImage","setIsGeneratingImage","isSpeaking","setIsSpeaking","voiceName","setVoiceName","showSettingsModal","setShowSettingsModal","selectedImage","setSelectedImage","systemInstruction","setSystemInstruction","generationSettings","setGenerationSettings","temperature","topK","topP","showGeminiModal","setShowGeminiModal","translationTargetLanguage","setTranslationTargetLanguage","textToContinue","setTextToContinue","textToTranslate","setTextToTranslate","showCreativeWriterModal","setShowCreativeWriterModal","creativeTopic","setCreativeTopic","creativeStyle","setCreativeStyle","creativeTone","setCreativeTone","messagesEndRef","audioRef","currentAudioIdRef","inputRef","_messagesEndRef$curre","current","scrollIntoView","behavior","fetchWithExponentialBackoff","url","options","retries","delay","response","fetch","ok","_errorData$error","errorData","json","Error","message","statusText","includes","Promise","resolve","setTimeout","Object","keys","firebaseApp","authInstance","dbInstance","unsubscribe","currentUser","e","console","location","href","storedEmail","localStorage","getItem","modalDiv","document","createElement","className","innerHTML","body","appendChild","emailConfirmInput","querySelector","emailConfirmButton","onclick","value","removeChild","continueSignIn","emailToUse","then","result","removeItem","history","replaceState","title","pathname","catch","conversationsCollectionRef","uid","querySnapshot","fetchedConversations","forEach","push","id","data","sort","a","b","_b$lastUpdated","_a$lastUpdated","lastUpdated","seconds","firestoreError","messagesCollectionRef","fetchedMessages","_a$timestamp","_b$timestamp","timestamp","startNewChat","newConversationDocRef","newConvId","createdAt","_inputRef$current","focus","handleSendMessage","preventDefault","trim","conversationIdToUse","userMessageText","imageToSend","_inputRef$current2","command","toLowerCase","initialTitle","substring","createError","conversationDocRef","merge","updateError","text","userId","userName","imageData","handleImageAnalysis","startsWith","imagePrompt","handleGenerateImage","handleAIResponse","handleImageUpload","event","file","target","files","reader","FileReader","onloadend","readAsDataURL","handleSendSignInLink","actionCodeSettings","origin","handleCodeInApp","setItem","handleEmailPasswordSignUp","handleEmailPasswordSignIn","handleSignOut","userPrompt","conversationId","promptText","newMessages","chatHistory","q","role","parts","payload","contents","generationConfig","undefined","apiUrl","_result$candidates","_result$candidates$","_result$candidates$$c","_result$candidates$$c2","_result$candidates$$c3","method","headers","stringify","aiResponseText","candidates","content","base64ImageData","split","inlineData","mimeType","_result$candidates2","_result$candidates2$","_result$candidates2$$","_result$candidates2$$2","_result$candidates2$$3","instances","prompt","parameters","_result$predictions","_result$predictions$","base64Data","predictions","bytesBase64Encoded","imageUrl","handleTTS","messageId","languageCode","ttsVoice","responseModalities","speechConfig","voiceConfig","prebuiltVoiceConfig","model","_result$candidates3","_result$candidates3$","_result$candidates3$$","_result$candidates3$$2","_part$inlineData","_part$inlineData2","part","audioData","parseInt","match","wavBlob","audioUrl","URL","createObjectURL","src","play","onended","revokeObjectURL","handleCreativeWriting","topic","style","tone","_result$candidates4","_result$candidates4$","_result$candidates4$$","_result$candidates4$$2","_result$candidates4$$3","handleTranslateText","language","_result$candidates5","_result$candidates5$","_result$candidates5$$","_result$candidates5$$2","_result$candidates5$$3","handleContinueText","_result$candidates6","_result$candidates6$","_result$candidates6$$","_result$candidates6$$2","_result$candidates6$$3","handleSummarizeConversation","_result$candidates7","_result$candidates7$","_result$candidates7$$","_result$candidates7$$2","_result$candidates7$$3","summaryText","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","reload","disabled","map","conv","find","msg","index","alt","dangerouslySetInnerHTML","__html","_audioRef$current","pause","ref","onSubmit","htmlFor","onChange","accept","placeholder","xmlns","width","height","viewBox","fill","stroke","strokeWidth","strokeLinecap","strokeLinejoin","d","rows","voice","_c","$RefreshReg$"],"sources":["C:/Users/Tommy/Desktop/my-chatbot-app/src/App.js"],"sourcesContent":["/* global __firebase_config, __app_id, __initial_auth_token */\r\n\r\n// import AppWindow from './index.js'; // (Unused import removed or comment out if not needed)\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { initializeApp } from 'firebase/app';\r\nimport {\r\n  getAuth,\r\n  signInWithCustomToken,\r\n  signInAnonymously,\r\n  onAuthStateChanged,\r\n  sendSignInLinkToEmail,\r\n  isSignInWithEmailLink,\r\n  signInWithEmailLink,\r\n  createUserWithEmailAndPassword,\r\n  signInWithEmailAndPassword,\r\n  signOut\r\n} from 'firebase/auth';\r\nimport {\r\n  getFirestore,\r\n  collection,\r\n  onSnapshot,\r\n  addDoc,\r\n  serverTimestamp,\r\n  doc,\r\n  setDoc,\r\n  query,\r\n  limit,\r\n  getDocs\r\n} from 'firebase/firestore';\r\nimport { marked } from 'marked';\r\nimport { createPortal } from 'react-dom';\r\nimport { Sparkles, MessageSquareMore, Image, LoaderCircle, X, ExternalLink, Menu, Plus, Play, Pause, Mic, Settings, Volume2, PenTool } from 'lucide-react';\r\n\r\n\r\n// --- Firebase Configuration ---\r\n// The global variables are provided by the Canvas environment.\r\n// We fall back to a local config for development purposes if they are not defined.\r\nconst localFirebaseConfig = {\r\n  apiKey: \"AIzaSyDhJoNaFf0qgl4VTuUXj16ysJG1hycq-p8\",\r\n  authDomain: \"ai-chatbot-88602.firebaseapp.com\",\r\n  projectId: \"ai-chatbot-88602\",\r\n  storageBucket: \"ai-chatbot-88602.firebasestorage.app\",\r\n  messagingSenderId: \"167580287666\",\r\n  appId: \"1:167580287666:web:9e8313ae6e667e47d47fab\",\r\n  measurementId: \"G-CXKJ8QRLZ1\"\r\n};\r\n\r\nconst firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : localFirebaseConfig;\r\nconst appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\r\nconst initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;\r\n\r\n// Utility function for generating unique IDs (like conversation IDs)\r\nconst generateId = () => {\r\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\r\n    const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);\r\n    return v.toString(16);\r\n  });\r\n};\r\n\r\n// Converts a base64 string to an ArrayBuffer\r\nfunction base64ToArrayBuffer(base64) {\r\n  const binaryString = window.atob(base64);\r\n  const len = binaryString.length;\r\n  const bytes = new Uint8Array(len);\r\n  for (let i = 0; i < len; i++) {\r\n    bytes[i] = binaryString.charCodeAt(i);\r\n  }\r\n  return bytes.buffer;\r\n}\r\n\r\n// Converts PCM audio data to a WAV blob\r\nfunction pcmToWav(pcmData, sampleRate) {\r\n  const pcm16 = new Int16Array(pcmData);\r\n  const buffer = new ArrayBuffer(44 + pcm16.length * 2);\r\n  const view = new DataView(buffer);\r\n  const writeString = (view, offset, string) => {\r\n      for (let i = 0; i < string.length; i++) {\r\n          view.setUint8(offset + i, string.charCodeAt(i));\r\n      }\r\n  };\r\n\r\n  let offset = 0;\r\n  writeString(view, offset, 'RIFF'); offset += 4;\r\n  view.setUint32(offset, 36 + pcm16.length * 2, true); offset += 4;\r\n  writeString(view, offset, 'WAVE'); offset += 4;\r\n  writeString(view, offset, 'fmt '); offset += 4;\r\n  view.setUint32(offset, 16, true); offset += 4; // Sub-chunk size\r\n  view.setUint16(offset, 1, true); offset += 2; // Audio format (1 = PCM)\r\n  view.setUint16(offset, 1, true); offset += 2; // Number of channels\r\n  view.setUint32(offset, sampleRate, true); offset += 4; // Sample rate\r\n  view.setUint32(offset, sampleRate * 2, true); offset += 4; // Byte rate\r\n  view.setUint16(offset, 2, true); offset += 2; // Block align\r\n  view.setUint16(offset, 16, true); offset += 2; // Bits per sample\r\n  writeString(view, offset, 'data'); offset += 4;\r\n  view.setUint32(offset, pcm16.length * 2, true); offset += 4; // Data size\r\n\r\n  for (let i = 0; i < pcm16.length; i++) {\r\n      view.setInt16(offset, pcm16[i], true);\r\n      offset += 2;\r\n  }\r\n\r\n  return new Blob([view], { type: 'audio/wav' });\r\n}\r\n\r\n// Prebuilt voices available for TTS\r\nconst prebuiltVoices = [\r\n  'Kore', 'Puck', 'Charon', 'Fenrir', 'Leda', 'Orus', 'Aoede', 'Callirrhoe', 'Autonoe',\r\n  'Enceladus', 'Iapetus', 'Umbriel', 'Algieba', 'Despina', 'Erinome', 'Algenib',\r\n  'Rasalgethi', 'Laomedeia', 'Achernar', 'Alnilam', 'Schedar', 'Gacrux',\r\n  'Pulcherrima', 'Achird', 'Zubenelgenubi', 'Vindemiatrix', 'Sadachbia', 'Sadaltager', 'Sulafat'\r\n];\r\n\r\n// The main App component\r\nfunction App() {\r\n  const [db, setDb] = useState(null);\r\n  const [auth, setAuth] = useState(null);\r\n  const [isAuthReady, setIsAuthReady] = useState(false);\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [messages, setMessages] = useState([]);\r\n  const [newMessage, setNewMessage] = useState('');\r\n  const [email, setEmail] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [emailSent, setEmailSent] = useState(false);\r\n  const [isSigningInWithLink, setIsSigningInWithLink] = useState(false);\r\n  const [isAIGenerating, setIsAIGenerating] = useState(false);\r\n  const [authMode, setAuthMode] = useState('email-link');\r\n\r\n  // New states for conversation history and sidebar\r\n  const [conversations, setConversations] = useState([]);\r\n  const [currentConversationId, setCurrentConversationId] = useState(null);\r\n  const [isSidebarOpen, setIsSidebarOpen] = useState(true);\r\n  const [isSummarizing, setIsSummarizing] = useState(false);\r\n  const [isGeneratingImage, setIsGeneratingImage] = useState(false);\r\n  const [isSpeaking, setIsSpeaking] = useState(false);\r\n  const [voiceName, setVoiceName] = useState('Kore');\r\n  const [showSettingsModal, setShowSettingsModal] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState(null);\r\n\r\n  // New states for Gemini features\r\n  const [systemInstruction, setSystemInstruction] = useState('');\r\n  const [generationSettings, setGenerationSettings] = useState({\r\n    temperature: 0.9,\r\n    topK: 40,\r\n    topP: 0.95\r\n  });\r\n  const [showGeminiModal, setShowGeminiModal] = useState(false);\r\n  const [translationTargetLanguage, setTranslationTargetLanguage] = useState('en-US');\r\n  const [textToContinue, setTextToContinue] = useState('');\r\n  const [textToTranslate, setTextToTranslate] = useState('');\r\n\r\n  // New state for the creative writing feature\r\n  const [showCreativeWriterModal, setShowCreativeWriterModal] = useState(false);\r\n  const [creativeTopic, setCreativeTopic] = useState('');\r\n  const [creativeStyle, setCreativeStyle] = useState('Poem');\r\n  const [creativeTone, setCreativeTone] = useState('Neutral');\r\n\r\n  const messagesEndRef = useRef(null);\r\n  const audioRef = useRef(null);\r\n  const currentAudioIdRef = useRef(null);\r\n  const inputRef = useRef(null); // Added this ref for the input element\r\n\r\n  // Scroll to bottom of messages whenever messages change\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  // Exponential backoff utility for API calls\r\n  const fetchWithExponentialBackoff = async (url, options, retries = 5, delay = 1000) => {\r\n    try {\r\n      const response = await fetch(url, options);\r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(`API error: ${errorData.error?.message || response.statusText}`);\r\n      }\r\n      return response;\r\n    } catch (error) {\r\n      if (retries > 0 && error.message.includes(\"API error\")) {\r\n        await new Promise(resolve => setTimeout(resolve, delay));\r\n        return fetchWithExponentialBackoff(url, options, retries - 1, delay * 2);\r\n      }\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  // 1. Initialize Firebase and set up authentication.\r\n  useEffect(() => {\r\n    if (Object.keys(firebaseConfig).length === 0 || !firebaseConfig.apiKey) {\r\n      setError('Firebase configuration is missing or incomplete. Please ensure your Firebase config is correctly set, especially the API Key.');\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const firebaseApp = initializeApp(firebaseConfig);\r\n      const authInstance = getAuth(firebaseApp);\r\n      const dbInstance = getFirestore(firebaseApp);\r\n\r\n      setAuth(authInstance);\r\n      setDb(dbInstance);\r\n\r\n      const unsubscribe = onAuthStateChanged(authInstance, async (currentUser) => {\r\n        if (currentUser) {\r\n          setUser(currentUser);\r\n          setIsAuthReady(true);\r\n          setError(null);\r\n        } else {\r\n          if (initialAuthToken) {\r\n             try {\r\n               await signInWithCustomToken(authInstance, initialAuthToken);\r\n             } catch (e) {\r\n               console.error(\"Custom token sign-in failed:\", e);\r\n               setError(`Custom token sign-in failed: ${e.message}. This usually means the token is invalid or expired. Please try refreshing.`);\r\n             }\r\n          } else if (!isSigningInWithLink) {\r\n            try {\r\n              await signInAnonymously(authInstance);\r\n            } catch (e) {\r\n              console.error(\"Anonymous sign-in failed:\", e);\r\n              setError(`Anonymous sign-in failed: ${e.message}. Please ensure Anonymous Authentication is enabled in your Firebase project settings.`);\r\n            }\r\n          }\r\n          setIsAuthReady(true);\r\n        }\r\n        setLoading(false);\r\n      });\r\n      return () => unsubscribe();\r\n    } catch (e) {\r\n      setError(`Failed to initialize Firebase: ${e.message}. Please check the console for more details.`);\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  // 2. Handle email link sign-in.\r\n  useEffect(() => {\r\n    if (!auth || !isAuthReady) return;\r\n\r\n    if (isSignInWithEmailLink(auth, window.location.href)) {\r\n      setIsSigningInWithLink(true);\r\n      setLoading(true);\r\n\r\n      let storedEmail = window.localStorage.getItem('emailForSignIn');\r\n\r\n      if (!storedEmail) {\r\n        // Using a custom modal instead of prompt\r\n        const modalDiv = document.createElement('div');\r\n        modalDiv.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50';\r\n        modalDiv.innerHTML = `\r\n          <div class=\"bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg max-w-sm w-full\">\r\n            <h3 class=\"text-xl font-bold mb-4\">Confirm Email</h3>\r\n            <p class=\"mb-4\">Please provide your email to complete sign-in.</p>\r\n            <input id=\"email-confirm-input\" type=\"email\" placeholder=\"Enter your email\" class=\"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500\" required />\r\n            <button id=\"email-confirm-button\" class=\"w-full bg-indigo-500 text-white p-3 rounded-lg shadow-md hover:bg-indigo-600 transition-colors duration-200\">Confirm</button>\r\n          </div>\r\n        `;\r\n        document.body.appendChild(modalDiv);\r\n\r\n        const emailConfirmInput = modalDiv.querySelector('#email-confirm-input');\r\n        const emailConfirmButton = modalDiv.querySelector('#email-confirm-button');\r\n\r\n        emailConfirmButton.onclick = () => {\r\n          storedEmail = emailConfirmInput.value;\r\n          if (storedEmail) {\r\n            document.body.removeChild(modalDiv);\r\n            continueSignIn(storedEmail);\r\n          } else {\r\n            console.error(\"Email not provided. Please try again.\");\r\n          }\r\n        };\r\n\r\n        const continueSignIn = (emailToUse) => {\r\n          signInWithEmailLink(auth, emailToUse, window.location.href)\r\n            .then((result) => {\r\n              window.localStorage.removeItem('emailForSignIn');\r\n              setUser(result.user);\r\n              setIsSigningInWithLink(false);\r\n              setLoading(false);\r\n              setError(null);\r\n              window.history.replaceState({}, document.title, window.location.pathname);\r\n            })\r\n            .catch((error) => {\r\n              setError(`Error completing sign-in with link: ${error.message}`);\r\n              setIsSigningInWithLink(false);\r\n              setLoading(false);\r\n              window.history.replaceState({}, document.title, window.location.pathname);\r\n            });\r\n        };\r\n        return; // Exit the effect to wait for user input\r\n      }\r\n\r\n      signInWithEmailLink(auth, storedEmail, window.location.href)\r\n        .then((result) => {\r\n          window.localStorage.removeItem('emailForSignIn');\r\n          setUser(result.user);\r\n          setIsSigningInWithLink(false);\r\n          setLoading(false);\r\n          setError(null);\r\n          window.history.replaceState({}, document.title, window.location.pathname);\r\n        })\r\n        .catch((error) => {\r\n          setError(`Error completing sign-in with link: ${error.message}`);\r\n          setIsSigningInWithLink(false);\r\n          setLoading(false);\r\n          window.history.replaceState({}, document.title, window.location.pathname);\r\n        });\r\n    }\r\n  }, [auth, isAuthReady]);\r\n\r\n  // 3. Fetch conversations for the current user.\r\n  useEffect(() => {\r\n    if (!db || !user || !isAuthReady) return;\r\n\r\n    const conversationsCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations');\r\n    const unsubscribe = onSnapshot(conversationsCollectionRef, (querySnapshot) => {\r\n      const fetchedConversations = [];\r\n      querySnapshot.forEach((doc) => {\r\n        fetchedConversations.push({ id: doc.id, ...doc.data() });\r\n      });\r\n\r\n      fetchedConversations.sort((a, b) => (b.lastUpdated?.seconds || 0) - (a.lastUpdated?.seconds || 0));\r\n\r\n      setConversations(fetchedConversations);\r\n\r\n      if (!currentConversationId && fetchedConversations.length > 0) {\r\n        setCurrentConversationId(fetchedConversations[0].id);\r\n      } else if (fetchedConversations.length === 0) {\r\n        setCurrentConversationId(null);\r\n        setMessages([]);\r\n      }\r\n    }, (firestoreError) => {\r\n      setError(`Failed to load conversations: ${firestoreError.message}`);\r\n      console.error(\"Firestore conversations error:\", firestoreError);\r\n    });\r\n\r\n    return () => unsubscribe();\r\n  }, [db, user, isAuthReady, appId, currentConversationId]);\r\n\r\n  // 4. Fetch messages for the current conversation.\r\n  useEffect(() => {\r\n    if (!db || !user || !currentConversationId) {\r\n      setMessages([]); // Clear messages if no conversation is selected\r\n      return;\r\n    }\r\n\r\n    const messagesCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations', currentConversationId, 'messages');\r\n    const unsubscribe = onSnapshot(messagesCollectionRef, (querySnapshot) => {\r\n      const fetchedMessages = [];\r\n      querySnapshot.forEach((doc) => {\r\n        fetchedMessages.push({ id: doc.id, ...doc.data() });\r\n      });\r\n\r\n      fetchedMessages.sort((a, b) => (a.timestamp?.seconds || 0) - (b.timestamp?.seconds || 0));\r\n\r\n      setMessages(fetchedMessages);\r\n    }, (firestoreError) => {\r\n      setError(`Failed to load messages for conversation: ${firestoreError.message}`);\r\n      console.error(\"Firestore messages error:\", firestoreError);\r\n    });\r\n\r\n    return () => unsubscribe();\r\n  }, [db, user, currentConversationId, appId]);\r\n\r\n  // 5. Start a new conversation.\r\n  const startNewChat = async () => {\r\n    if (!db || !user) {\r\n      setError(\"You must be logged in to start a new chat.\");\r\n      return;\r\n    }\r\n\r\n    setMessages([]);\r\n    setNewMessage('');\r\n    setSelectedImage(null);\r\n    setError(null);\r\n    setIsAIGenerating(false);\r\n    setIsSummarizing(false);\r\n    setIsGeneratingImage(false);\r\n\r\n    try {\r\n      const conversationsCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations');\r\n      const newConversationDocRef = doc(conversationsCollectionRef);\r\n      const newConvId = newConversationDocRef.id;\r\n\r\n      await setDoc(newConversationDocRef, {\r\n        title: 'New Chat',\r\n        createdAt: serverTimestamp(),\r\n        lastUpdated: serverTimestamp(),\r\n      });\r\n      setCurrentConversationId(newConvId);\r\n      setIsSidebarOpen(false);\r\n      // Immediately focus the input after starting a new chat\r\n      setTimeout(() => {\r\n        inputRef.current?.focus();\r\n      }, 0);\r\n    } catch (e) {\r\n      setError(`Failed to create a new chat: ${e.message}`);\r\n      console.error(\"Error creating new conversation:\", e);\r\n    }\r\n  };\r\n\r\n  // 6. Handle sending a new message (and creating a new conversation if needed).\r\n  const handleSendMessage = async (e) => {\r\n    e.preventDefault();\r\n    if (!newMessage.trim() && !selectedImage || !user || !db || isAIGenerating || isSpeaking) return;\r\n\r\n    let conversationIdToUse = currentConversationId;\r\n    const userMessageText = newMessage;\r\n    const imageToSend = selectedImage;\r\n\r\n    setNewMessage('');\r\n    setSelectedImage(null);\r\n\r\n    // After sending the message, immediately refocus the input field\r\n    setTimeout(() => {\r\n      inputRef.current?.focus();\r\n    }, 0);\r\n\r\n    const command = userMessageText.toLowerCase().trim();\r\n\r\n    // If no conversation is active, create a new one.\r\n    if (!conversationIdToUse) {\r\n      const newConvId = generateId();\r\n      const conversationsCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations');\r\n      const newConversationDocRef = doc(conversationsCollectionRef, newConvId);\r\n      const initialTitle = userMessageText ? (userMessageText.substring(0, 50) + (userMessageText.length > 50 ? '...' : '')) : 'New chat with image';\r\n\r\n      try {\r\n        await setDoc(newConversationDocRef, {\r\n          title: initialTitle,\r\n          createdAt: serverTimestamp(),\r\n          lastUpdated: serverTimestamp(),\r\n        });\r\n        conversationIdToUse = newConvId;\r\n        setCurrentConversationId(newConvId);\r\n      } catch (createError) {\r\n        setError(`Failed to create new conversation: ${createError.message}`);\r\n        console.error(\"Error creating new conversation:\", createError);\r\n        return;\r\n      }\r\n    } else {\r\n      // Otherwise, just update the lastUpdated timestamp of the current conversation.\r\n      const conversationDocRef = doc(db, 'artifacts', appId, 'users', user.uid, 'conversations', conversationIdToUse);\r\n      try {\r\n        await setDoc(conversationDocRef, { lastUpdated: serverTimestamp() }, { merge: true });\r\n      } catch (updateError) {\r\n        console.error(\"Error updating conversation timestamp:\", updateError);\r\n      }\r\n    }\r\n\r\n    // Add user message to Firestore\r\n    try {\r\n      const messagesCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations', conversationIdToUse, 'messages');\r\n      await addDoc(messagesCollectionRef, {\r\n        text: userMessageText,\r\n        userId: user.uid,\r\n        userName: `User_${user.uid.substring(0, 5)}`,\r\n        timestamp: serverTimestamp(),\r\n        type: 'user-message',\r\n        imageData: imageToSend\r\n      });\r\n    } catch (e) {\r\n      setError(`Failed to send message: ${e.message}`);\r\n      return;\r\n    }\r\n\r\n    if (imageToSend) {\r\n      handleImageAnalysis(userMessageText, imageToSend, conversationIdToUse);\r\n    } else if (command.startsWith('image of')) {\r\n      const imagePrompt = userMessageText.substring('image of'.length).trim();\r\n      handleGenerateImage(imagePrompt, conversationIdToUse);\r\n    } else {\r\n      handleAIResponse(userMessageText, conversationIdToUse);\r\n    }\r\n  };\r\n\r\n  // Function to handle image upload\r\n  const handleImageUpload = (event) => {\r\n    const file = event.target.files[0];\r\n    if (file) {\r\n      const reader = new FileReader();\r\n      reader.onloadend = () => {\r\n        setSelectedImage(reader.result);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  };\r\n\r\n  // 7. Handle sending the sign-in email link.\r\n  const handleSendSignInLink = async (e) => {\r\n    e.preventDefault();\r\n    if (!auth || !email.trim()) {\r\n      setError(\"Please enter a valid email address.\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    const actionCodeSettings = {\r\n      url: window.location.origin,\r\n      handleCodeInApp: true,\r\n    };\r\n\r\n    try {\r\n      await sendSignInLinkToEmail(auth, email, actionCodeSettings);\r\n      setEmailSent(true);\r\n      window.localStorage.setItem('emailForSignIn', email);\r\n      setLoading(false);\r\n    } catch (error) {\r\n      setError(`Failed to send sign-in link: ${error.message}`);\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // 8. Handle Email/Password Registration\r\n  const handleEmailPasswordSignUp = async (e) => {\r\n    e.preventDefault();\r\n    if (!auth || !email.trim() || !password.trim()) {\r\n      setError(\"Please enter a valid email and password.\");\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      await createUserWithEmailAndPassword(auth, email, password);\r\n      setEmail('');\r\n      setPassword('');\r\n      setLoading(false);\r\n    } catch (error) {\r\n      setError(`Failed to sign up: ${error.message}`);\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // 9. Handle Email/Password Login\r\n  const handleEmailPasswordSignIn = async (e) => {\r\n    e.preventDefault();\r\n    if (!auth || !email.trim() || !password.trim()) {\r\n      setError(\"Please enter a valid email and password.\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      await signInWithEmailAndPassword(auth, email, password);\r\n      setEmail('');\r\n      setPassword('');\r\n      setLoading(false);\r\n    } catch (error) {\r\n      setError(`Failed to sign in: ${error.message}`);\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // 10. Handle sign-out.\r\n  const handleSignOut = async () => {\r\n    if (!auth) return;\r\n    try {\r\n      await signOut(auth);\r\n      // Reset states\r\n      setUser(null);\r\n      setConversations([]);\r\n      setMessages([]);\r\n      setCurrentConversationId(null);\r\n      setError(null);\r\n    } catch (error) {\r\n      setError(`Failed to sign out: ${error.message}`);\r\n      console.error(\"Sign out error:\", error);\r\n    }\r\n  };\r\n\r\n  // 11. Handle AI response using Gemini API.\r\n  const handleAIResponse = async (userPrompt, conversationId) => {\r\n    if (!user || !db || !conversationId) return;\r\n\r\n    setIsAIGenerating(true);\r\n    let promptText = userPrompt;\r\n    let newMessages = [...messages];\r\n\r\n    const messagesCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations', conversationId, 'messages');\r\n    \r\n    // Get the conversation history to provide context to the AI\r\n    let chatHistory = [];\r\n    try {\r\n      const q = query(messagesCollectionRef, limit(20));\r\n      const querySnapshot = await getDocs(q);\r\n      querySnapshot.forEach(doc => {\r\n        const data = doc.data();\r\n        if (data.type === 'user-message') {\r\n          chatHistory.push({ role: 'user', parts: [{ text: data.text }] });\r\n        } else if (data.type === 'ai-message') {\r\n          chatHistory.push({ role: 'model', parts: [{ text: data.text }] });\r\n        }\r\n      });\r\n      // Add the latest user prompt\r\n      chatHistory.push({ role: \"user\", parts: [{ text: promptText }] });\r\n    } catch (e) {\r\n      console.error(\"Error fetching chat history:\", e);\r\n      // If fetching history fails, just use the current prompt\r\n      chatHistory = [{ role: \"user\", parts: [{ text: promptText }] }];\r\n    }\r\n\r\n    const payload = {\r\n      contents: chatHistory,\r\n      generationConfig: {\r\n        temperature: generationSettings.temperature,\r\n        topK: generationSettings.topK,\r\n        topP: generationSettings.topP,\r\n      },\r\n      systemInstruction: systemInstruction ? { parts: [{ text: systemInstruction }] } : undefined,\r\n    };\r\n\r\n    const apiKey = \"\";\r\n    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;\r\n\r\n    try {\r\n      const response = await fetchWithExponentialBackoff(apiUrl, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(payload)\r\n      });\r\n      const result = await response.json();\r\n\r\n      const aiResponseText = result.candidates?.[0]?.content?.parts?.[0]?.text || 'No response from AI.';\r\n\r\n      // Add AI response to Firestore\r\n      await addDoc(messagesCollectionRef, {\r\n        text: aiResponseText,\r\n        userId: 'ai',\r\n        userName: 'Gemini',\r\n        timestamp: serverTimestamp(),\r\n        type: 'ai-message'\r\n      });\r\n\r\n    } catch (e) {\r\n      console.error(\"Gemini API error:\", e);\r\n      setError(`Gemini API error: ${e.message}`);\r\n    } finally {\r\n      setIsAIGenerating(false);\r\n    }\r\n  };\r\n\r\n  // 12. Handle image analysis with Gemini Vision API\r\n  const handleImageAnalysis = async (userPrompt, imageData, conversationId) => {\r\n    if (!user || !db || !conversationId) return;\r\n\r\n    setIsAIGenerating(true);\r\n\r\n    const messagesCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations', conversationId, 'messages');\r\n\r\n    // Remove the data URL prefix \"data:image/png;base64,\"\r\n    const base64ImageData = imageData.split(',')[1];\r\n\r\n    const payload = {\r\n        contents: [\r\n            {\r\n                role: \"user\",\r\n                parts: [\r\n                    { text: userPrompt || 'What is in this image?' },\r\n                    {\r\n                        inlineData: {\r\n                            mimeType: \"image/png\", // Assuming PNG, but should be dynamic if possible\r\n                            data: base64ImageData\r\n                        }\r\n                    }\r\n                ]\r\n            }\r\n        ],\r\n    };\r\n\r\n    const apiKey = \"\";\r\n    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;\r\n\r\n    try {\r\n        const response = await fetchWithExponentialBackoff(apiUrl, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(payload)\r\n        });\r\n        const result = await response.json();\r\n        const aiResponseText = result.candidates?.[0]?.content?.parts?.[0]?.text || 'No response from AI.';\r\n\r\n        // Add AI response to Firestore\r\n        await addDoc(messagesCollectionRef, {\r\n            text: aiResponseText,\r\n            userId: 'ai',\r\n            userName: 'Gemini',\r\n            timestamp: serverTimestamp(),\r\n            type: 'ai-message'\r\n        });\r\n    } catch (e) {\r\n        console.error(\"Gemini Vision API error:\", e);\r\n        setError(`Gemini Vision API error: ${e.message}`);\r\n    } finally {\r\n        setIsAIGenerating(false);\r\n    }\r\n  };\r\n\r\n  // 13. Handle image generation with Imagen API\r\n  const handleGenerateImage = async (imagePrompt, conversationId) => {\r\n    if (!user || !db || !conversationId) return;\r\n\r\n    setIsGeneratingImage(true);\r\n\r\n    const messagesCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations', conversationId, 'messages');\r\n\r\n    const payload = { instances: { prompt: imagePrompt }, parameters: { \"sampleCount\": 1 } };\r\n    const apiKey = \"\";\r\n    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;\r\n\r\n    try {\r\n        const response = await fetchWithExponentialBackoff(apiUrl, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(payload)\r\n        });\r\n        const result = await response.json();\r\n        const base64Data = result.predictions?.[0]?.bytesBase64Encoded;\r\n\r\n        if (base64Data) {\r\n            const imageUrl = `data:image/png;base64,${base64Data}`;\r\n            // Add AI response to Firestore, including the image data\r\n            await addDoc(messagesCollectionRef, {\r\n                text: 'Generated Image',\r\n                userId: 'ai',\r\n                userName: 'Gemini',\r\n                timestamp: serverTimestamp(),\r\n                type: 'image-message',\r\n                imageData: imageUrl\r\n            });\r\n        } else {\r\n            throw new Error(\"No image data received from the API.\");\r\n        }\r\n    } catch (e) {\r\n        console.error(\"Imagen API error:\", e);\r\n        setError(`Imagen API error: ${e.message}`);\r\n    } finally {\r\n        setIsGeneratingImage(false);\r\n    }\r\n  };\r\n\r\n  // 14. Handle Text-to-Speech\r\n  const handleTTS = async (text, messageId, languageCode = 'en-US') => {\r\n    setIsSpeaking(true);\r\n    currentAudioIdRef.current = messageId;\r\n    const ttsVoice = prebuiltVoices.includes(voiceName) ? voiceName : 'Kore'; // Use Kore as default if voiceName is not valid\r\n    const payload = {\r\n        contents: [{\r\n            parts: [{ text: `Say in ${languageCode}: ${text}` }]\r\n        }],\r\n        generationConfig: {\r\n            responseModalities: [\"AUDIO\"],\r\n            speechConfig: {\r\n                voiceConfig: {\r\n                    prebuiltVoiceConfig: { voiceName: ttsVoice }\r\n                }\r\n            }\r\n        },\r\n        model: \"gemini-2.5-flash-preview-tts\"\r\n    };\r\n\r\n    const apiKey = \"\";\r\n    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;\r\n\r\n    try {\r\n        const response = await fetchWithExponentialBackoff(apiUrl, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(payload)\r\n        });\r\n        const result = await response.json();\r\n        const part = result?.candidates?.[0]?.content?.parts?.[0];\r\n        const audioData = part?.inlineData?.data;\r\n        const mimeType = part?.inlineData?.mimeType;\r\n\r\n        if (audioData && mimeType && mimeType.startsWith(\"audio/L16\")) {\r\n            const sampleRate = parseInt(mimeType.match(/rate=(\\d+)/)[1], 10);\r\n            const pcmData = base64ToArrayBuffer(audioData);\r\n            const wavBlob = pcmToWav(pcmData, sampleRate);\r\n            const audioUrl = URL.createObjectURL(wavBlob);\r\n            if (audioRef.current) {\r\n                audioRef.current.src = audioUrl;\r\n                audioRef.current.play();\r\n                audioRef.current.onended = () => {\r\n                    URL.revokeObjectURL(audioUrl);\r\n                    setIsSpeaking(false);\r\n                    currentAudioIdRef.current = null;\r\n                };\r\n            }\r\n        } else {\r\n            throw new Error('Invalid audio data received from API.');\r\n        }\r\n\r\n    } catch (e) {\r\n        console.error(\"TTS API error:\", e);\r\n        setError(`TTS API error: ${e.message}`);\r\n        setIsSpeaking(false);\r\n        currentAudioIdRef.current = null;\r\n    }\r\n  };\r\n\r\n  // 15. Handle creative writing\r\n  const handleCreativeWriting = async (topic, style, tone, conversationId) => {\r\n    if (!user || !db || !conversationId) return;\r\n\r\n    setIsAIGenerating(true);\r\n    const messagesCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations', conversationId, 'messages');\r\n\r\n    const prompt = `Write a ${style} about the topic: \"${topic}\". The tone should be ${tone}.`;\r\n    let chatHistory = [];\r\n    chatHistory.push({ role: \"user\", parts: [{ text: prompt }] });\r\n\r\n    const payload = {\r\n      contents: chatHistory,\r\n      generationConfig: {\r\n        temperature: 0.9,\r\n        topK: 40,\r\n        topP: 0.95,\r\n      },\r\n    };\r\n\r\n    const apiKey = \"\";\r\n    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;\r\n\r\n    try {\r\n      const response = await fetchWithExponentialBackoff(apiUrl, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(payload)\r\n      });\r\n      const result = await response.json();\r\n\r\n      const aiResponseText = result.candidates?.[0]?.content?.parts?.[0]?.text || 'No response from AI.';\r\n\r\n      await addDoc(messagesCollectionRef, {\r\n        text: aiResponseText,\r\n        userId: 'ai',\r\n        userName: 'Gemini',\r\n        timestamp: serverTimestamp(),\r\n        type: 'ai-message'\r\n      });\r\n    } catch (e) {\r\n      console.error(\"Creative Writing API error:\", e);\r\n      setError(`Creative Writing API error: ${e.message}`);\r\n    } finally {\r\n      setIsAIGenerating(false);\r\n      setShowCreativeWriterModal(false);\r\n    }\r\n  };\r\n\r\n  // 16. Handle text translation\r\n  const handleTranslateText = async (text, language, conversationId) => {\r\n    if (!user || !db || !conversationId) return;\r\n\r\n    setIsAIGenerating(true);\r\n    const messagesCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations', conversationId, 'messages');\r\n\r\n    const prompt = `Translate the following text to ${language}: \"${text}\"`;\r\n    let chatHistory = [];\r\n    chatHistory.push({ role: \"user\", parts: [{ text: prompt }] });\r\n\r\n    const payload = {\r\n      contents: chatHistory,\r\n      generationConfig: {\r\n        temperature: 0.1,\r\n        topK: 1,\r\n        topP: 0.9,\r\n      },\r\n    };\r\n\r\n    const apiKey = \"\";\r\n    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;\r\n\r\n    try {\r\n      const response = await fetchWithExponentialBackoff(apiUrl, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(payload)\r\n      });\r\n      const result = await response.json();\r\n\r\n      const aiResponseText = result.candidates?.[0]?.content?.parts?.[0]?.text || 'No response from AI.';\r\n\r\n      await addDoc(messagesCollectionRef, {\r\n        text: aiResponseText,\r\n        userId: 'ai',\r\n        userName: 'Gemini',\r\n        timestamp: serverTimestamp(),\r\n        type: 'ai-message'\r\n      });\r\n    } catch (e) {\r\n      console.error(\"Translation API error:\", e);\r\n      setError(`Translation API error: ${e.message}`);\r\n    } finally {\r\n      setIsAIGenerating(false);\r\n      setShowGeminiModal(false);\r\n    }\r\n  };\r\n\r\n  // 17. Handle text continuation\r\n  const handleContinueText = async (text, conversationId) => {\r\n    if (!user || !db || !conversationId) return;\r\n\r\n    setIsAIGenerating(true);\r\n    const messagesCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations', conversationId, 'messages');\r\n\r\n    const prompt = `Continue the following text: \"${text}\"`;\r\n    let chatHistory = [];\r\n    chatHistory.push({ role: \"user\", parts: [{ text: prompt }] });\r\n\r\n    const payload = {\r\n      contents: chatHistory,\r\n      generationConfig: {\r\n        temperature: 0.9,\r\n        topK: 40,\r\n        topP: 0.95,\r\n      },\r\n    };\r\n\r\n    const apiKey = \"AIzaSyCBBfnCqQlfrOCmSPzNuyC8F4jT0OHUX7g\";\r\n    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;\r\n\r\n    try {\r\n      const response = await fetchWithExponentialBackoff(apiUrl, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(payload)\r\n      });\r\n      const result = await response.json();\r\n\r\n      const aiResponseText = result.candidates?.[0]?.content?.parts?.[0]?.text || 'No response from AI.';\r\n\r\n      await addDoc(messagesCollectionRef, {\r\n        text: aiResponseText,\r\n        userId: 'ai',\r\n        userName: 'Gemini',\r\n        timestamp: serverTimestamp(),\r\n        type: 'ai-message'\r\n      });\r\n    } catch (e) {\r\n      console.error(\"Text Continuation API error:\", e);\r\n      setError(`Text Continuation API error: ${e.message}`);\r\n    } finally {\r\n      setIsAIGenerating(false);\r\n      setShowGeminiModal(false);\r\n    }\r\n  };\r\n\r\n  // 18. Handle message summarizing\r\n  const handleSummarizeConversation = async () => {\r\n    if (!user || !db || !currentConversationId) return;\r\n\r\n    setIsSummarizing(true);\r\n    const messagesCollectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'conversations', currentConversationId, 'messages');\r\n    \r\n    // Get the conversation history to provide context to the AI\r\n    let chatHistory = [];\r\n    try {\r\n      const q = query(messagesCollectionRef, limit(20));\r\n      const querySnapshot = await getDocs(q);\r\n      querySnapshot.forEach(doc => {\r\n        const data = doc.data();\r\n        chatHistory.push({ role: data.type === 'user-message' ? 'user' : 'model', parts: [{ text: data.text }] });\r\n      });\r\n    } catch (e) {\r\n      console.error(\"Error fetching chat history:\", e);\r\n      setError(`Error fetching chat history for summarization: ${e.message}`);\r\n      setIsSummarizing(false);\r\n      return;\r\n    }\r\n    \r\n    const prompt = `Summarize the following conversation.`;\r\n    chatHistory.push({ role: \"user\", parts: [{ text: prompt }] });\r\n    \r\n    const payload = {\r\n      contents: chatHistory,\r\n      generationConfig: {\r\n        temperature: 0.2, // Lower temperature for factual summary\r\n        topK: 1,\r\n        topP: 0.9,\r\n      },\r\n    };\r\n    \r\n    const apiKey = \"AIzaSyCBBfnCqQlfrOCmSPzNuyC8F4jT0OHUX7g\";\r\n    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;\r\n    \r\n    try {\r\n      const response = await fetchWithExponentialBackoff(apiUrl, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(payload)\r\n      });\r\n      const result = await response.json();\r\n      const summaryText = result.candidates?.[0]?.content?.parts?.[0]?.text || 'Could not generate a summary.';\r\n      \r\n      const conversationDocRef = doc(db, 'artifacts', appId, 'users', user.uid, 'conversations', currentConversationId);\r\n      await setDoc(conversationDocRef, { title: summaryText }, { merge: true });\r\n    } catch (e) {\r\n      console.error(\"Summarization API error:\", e);\r\n      setError(`Summarization API error: ${e.message}`);\r\n    } finally {\r\n      setIsSummarizing(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100\">\r\n        <LoaderCircle className=\"h-10 w-10 animate-spin text-indigo-500\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"flex flex-col items-center justify-center h-screen bg-red-50 dark:bg-red-900 text-red-800 dark:text-red-200 p-4\">\r\n        <h1 className=\"text-xl font-bold mb-4\">An error occurred</h1>\r\n        <p className=\"text-center\">{error}</p>\r\n        <button onClick={() => window.location.reload()} className=\"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors\">\r\n          Reload App\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex h-screen bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 overflow-hidden\">\r\n      {/* Sidebar */}\r\n      <aside\r\n        className={`bg-white dark:bg-gray-800 shadow-lg p-6 flex flex-col transition-transform duration-300 ease-in-out ${\r\n          isSidebarOpen ? 'translate-x-0' : '-translate-x-full'\r\n        } fixed inset-y-0 left-0 w-64 z-40 lg:relative lg:translate-x-0`}\r\n      >\r\n        <div className=\"flex-1 overflow-y-auto\">\r\n          <div className=\"flex items-center justify-between mb-6\">\r\n            <h2 className=\"text-2xl font-bold\">Chats</h2>\r\n            <button\r\n              onClick={() => setIsSidebarOpen(!isSidebarOpen)}\r\n              className=\"p-2 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700 lg:hidden\"\r\n            >\r\n              <X className=\"h-5 w-5\" />\r\n            </button>\r\n          </div>\r\n          <button\r\n            onClick={startNewChat}\r\n            className=\"w-full bg-indigo-500 text-white p-3 rounded-lg shadow-md hover:bg-indigo-600 transition-colors duration-200 mb-4 flex items-center justify-center\"\r\n            disabled={isAIGenerating}\r\n          >\r\n            <Plus className=\"h-5 w-5 mr-2\" /> New Chat\r\n          </button>\r\n          <ul className=\"space-y-2\">\r\n            {conversations.map((conv) => (\r\n              <li key={conv.id}>\r\n                <button\r\n                  onClick={() => {\r\n                    setCurrentConversationId(conv.id);\r\n                    setIsSidebarOpen(false); // Close sidebar on mobile after selection\r\n                  }}\r\n                  className={`w-full text-left p-3 rounded-lg transition-colors duration-200 ${\r\n                    conv.id === currentConversationId\r\n                      ? 'bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-100 font-semibold'\r\n                      : 'hover:bg-gray-200 dark:hover:bg-gray-700'\r\n                  }`}\r\n                >\r\n                  {conv.title}\r\n                </button>\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        </div>\r\n        <div className=\"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\r\n          <div className=\"flex justify-between items-center mb-2\">\r\n            <span className=\"text-sm font-medium\">User ID:</span>\r\n            <span className=\"text-xs break-all\">{user?.uid}</span>\r\n          </div>\r\n          <button\r\n            onClick={handleSignOut}\r\n            className=\"w-full text-left p-3 text-red-500 hover:bg-red-100 dark:hover:bg-red-900 rounded-lg transition-colors duration-200 flex items-center justify-center\"\r\n          >\r\n            Sign Out\r\n          </button>\r\n        </div>\r\n      </aside>\r\n\r\n      {/* Main Chat Area */}\r\n      <main className=\"flex-1 flex flex-col\">\r\n        {/* Top Bar for Mobile */}\r\n        <header className=\"bg-white dark:bg-gray-800 shadow-md p-4 flex items-center justify-between lg:hidden\">\r\n          <button\r\n            onClick={() => setIsSidebarOpen(true)}\r\n            className=\"p-2 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700\"\r\n          >\r\n            <Menu className=\"h-6 w-6\" />\r\n          </button>\r\n          <h1 className=\"text-xl font-bold truncate flex-1 text-center\">\r\n            {conversations.find(c => c.id === currentConversationId)?.title || 'New Chat'}\r\n          </h1>\r\n          <button\r\n            onClick={() => startNewChat()}\r\n            className=\"p-2 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700\"\r\n            disabled={isAIGenerating}\r\n          >\r\n            <Plus className=\"h-6 w-6\" />\r\n          </button>\r\n        </header>\r\n\r\n        {/* Message Display Area */}\r\n        <div className=\"flex-1 overflow-y-auto p-6 space-y-6\">\r\n          {messages.length === 0 && (\r\n            <div className=\"flex flex-col items-center justify-center h-full text-gray-400 dark:text-gray-600\">\r\n              <Sparkles className=\"h-16 w-16 mb-4\" />\r\n              <p className=\"text-xl font-semibold\">Start a new conversation</p>\r\n            </div>\r\n          )}\r\n          {messages.map((msg, index) => (\r\n            <div\r\n              key={msg.id}\r\n              className={`flex items-start space-x-4 ${\r\n                msg.type === 'user-message' ? 'justify-end' : 'justify-start'\r\n              }`}\r\n            >\r\n              <div\r\n                className={`p-4 rounded-xl shadow-sm ${\r\n                  msg.type === 'user-message'\r\n                    ? 'bg-indigo-500 text-white rounded-br-none'\r\n                    : 'bg-white dark:bg-gray-800 rounded-bl-none'\r\n                }`}\r\n              >\r\n                {msg.type === 'image-message' && msg.imageData ? (\r\n                  <img src={msg.imageData} alt=\"Generated\" className=\"max-w-xs rounded-lg\" />\r\n                ) : (\r\n                  <div dangerouslySetInnerHTML={{ __html: marked(msg.text || '') }} />\r\n                )}\r\n                <div className=\"flex justify-end items-center mt-2\">\r\n                  {msg.type === 'ai-message' && (\r\n                    <>\r\n                      <button\r\n                        onClick={() => {\r\n                            if (currentAudioIdRef.current === msg.id) {\r\n                                audioRef.current?.pause();\r\n                                setIsSpeaking(false);\r\n                                currentAudioIdRef.current = null;\r\n                            } else {\r\n                                handleTTS(msg.text, msg.id);\r\n                            }\r\n                        }}\r\n                        className={`p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 ${currentAudioIdRef.current === msg.id ? 'text-indigo-500' : 'text-gray-500'}`}\r\n                        disabled={isSpeaking && currentAudioIdRef.current !== msg.id}\r\n                      >\r\n                        {isSpeaking && currentAudioIdRef.current === msg.id ? <Pause className=\"h-4 w-4\" /> : <Volume2 className=\"h-4 w-4\" />}\r\n                      </button>\r\n                    </>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n          {(isAIGenerating || isSummarizing || isGeneratingImage) && (\r\n            <div className=\"flex items-start space-x-4\">\r\n              <div className=\"p-4 rounded-xl shadow-sm bg-white dark:bg-gray-800 rounded-bl-none\">\r\n                <LoaderCircle className=\"h-6 w-6 animate-spin text-indigo-500\" />\r\n              </div>\r\n            </div>\r\n          )}\r\n          <div ref={messagesEndRef} />\r\n        </div>\r\n\r\n        {/* Input Area */}\r\n        <div className=\"bg-white dark:bg-gray-800 shadow-inner p-4\">\r\n          {selectedImage && (\r\n            <div className=\"mb-4 relative w-24 h-24\">\r\n              <img src={selectedImage} alt=\"Selected\" className=\"w-full h-full object-cover rounded-lg\" />\r\n              <button\r\n                onClick={() => setSelectedImage(null)}\r\n                className=\"absolute top-1 right-1 p-1 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-75\"\r\n              >\r\n                <X className=\"h-4 w-4\" />\r\n              </button>\r\n            </div>\r\n          )}\r\n          <form onSubmit={handleSendMessage} className=\"flex items-center space-x-4\">\r\n            <label htmlFor=\"file-upload\" className=\"cursor-pointer p-3 text-gray-500 hover:text-indigo-500 transition-colors duration-200\">\r\n                <Image className=\"h-6 w-6\" />\r\n            </label>\r\n            <input id=\"file-upload\" type=\"file\" onChange={handleImageUpload} className=\"hidden\" accept=\"image/*\" />\r\n\r\n            <button\r\n                type=\"button\"\r\n                onClick={() => setShowCreativeWriterModal(true)}\r\n                className=\"p-3 text-gray-500 hover:text-indigo-500 transition-colors duration-200\"\r\n            >\r\n                <PenTool className=\"h-6 w-6\" />\r\n            </button>\r\n\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => handleSummarizeConversation()}\r\n              className=\"p-3 text-gray-500 hover:text-indigo-500 transition-colors duration-200\"\r\n              disabled={isSummarizing || !currentConversationId}\r\n              title=\"Summarize current conversation\"\r\n            >\r\n              <MessageSquareMore className=\"h-6 w-6\" />\r\n            </button>\r\n\r\n            <button\r\n                type=\"button\"\r\n                onClick={() => setShowGeminiModal(true)}\r\n                className=\"p-3 text-gray-500 hover:text-indigo-500 transition-colors duration-200\"\r\n            >\r\n                <Sparkles className=\"h-6 w-6\" />\r\n            </button>\r\n            \r\n            <input\r\n              type=\"text\"\r\n              ref={inputRef} // Added the ref here\r\n              value={newMessage}\r\n              onChange={(e) => setNewMessage(e.target.value)}\r\n              placeholder=\"Type a message...\"\r\n              className=\"flex-1 p-3 border border-gray-300 dark:border-gray-600 rounded-full bg-gray-50 dark:bg-gray-800 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500\"\r\n              disabled={isAIGenerating || isSpeaking}\r\n            />\r\n            <button\r\n              type=\"submit\"\r\n              className=\"p-3 bg-indigo-500 text-white rounded-full shadow-md hover:bg-indigo-600 transition-colors duration-200\"\r\n              disabled={isAIGenerating || isSpeaking}\r\n            >\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className=\"lucide lucide-send-horizontal\"><path d=\"m3 3 3 9-3 9 19-9Z\"/><path d=\"M6 12h16\"/></svg>\r\n            </button>\r\n          </form>\r\n        </div>\r\n      </main>\r\n\r\n      {/* Audio Player for TTS */}\r\n      <audio ref={audioRef} className=\"hidden\" />\r\n\r\n      {/* Creative Writer Modal */}\r\n      {showCreativeWriterModal && createPortal(\r\n        <div className=\"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-white dark:bg-gray-900 rounded-xl shadow-lg p-6 w-full max-w-md mx-4\">\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n              <h2 className=\"text-xl font-bold\">Creative Writer</h2>\r\n              <button onClick={() => setShowCreativeWriterModal(false)} className=\"p-1 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700\">\r\n                <X className=\"h-5 w-5\" />\r\n              </button>\r\n            </div>\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Topic</label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={creativeTopic}\r\n                  onChange={(e) => setCreativeTopic(e.target.value)}\r\n                  className=\"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500\"\r\n                  placeholder=\"e.g., A journey through a forest\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Style</label>\r\n                <select\r\n                  value={creativeStyle}\r\n                  onChange={(e) => setCreativeStyle(e.target.value)}\r\n                  className=\"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500\"\r\n                >\r\n                  <option value=\"Poem\">Poem</option>\r\n                  <option value=\"Short Story\">Short Story</option>\r\n                  <option value=\"Blog Post\">Blog Post</option>\r\n                  <option value=\"News Article\">News Article</option>\r\n                </select>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Tone</label>\r\n                <select\r\n                  value={creativeTone}\r\n                  onChange={(e) => setCreativeTone(e.target.value)}\r\n                  className=\"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500\"\r\n                >\r\n                  <option value=\"Neutral\">Neutral</option>\r\n                  <option value=\"Happy\">Happy</option>\r\n                  <option value=\"Sad\">Sad</option>\r\n                  <option value=\"Excited\">Excited</option>\r\n                  <option value=\"Mysterious\">Mysterious</option>\r\n                </select>\r\n              </div>\r\n\r\n              <button\r\n                onClick={() => handleCreativeWriting(creativeTopic, creativeStyle, creativeTone, currentConversationId)}\r\n                className=\"w-full bg-indigo-500 text-white p-3 rounded-lg shadow-md hover:bg-indigo-600 transition-colors duration-200 mt-4\"\r\n                disabled={isAIGenerating || !creativeTopic}\r\n              >\r\n                Generate\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>,\r\n        document.body\r\n      )}\r\n\r\n      {/* Gemini Modal for text continuation and translation */}\r\n      {showGeminiModal && createPortal(\r\n        <div className=\"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-white dark:bg-gray-900 rounded-xl shadow-lg p-6 w-full max-w-md mx-4\">\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n              <h2 className=\"text-xl font-bold\">Gemini Features</h2>\r\n              <button onClick={() => setShowGeminiModal(false)} className=\"p-1 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700\">\r\n                <X className=\"h-5 w-5\" />\r\n              </button>\r\n            </div>\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <h3 className=\"text-lg font-semibold mb-2\">Continue Text</h3>\r\n                <textarea\r\n                  value={textToContinue}\r\n                  onChange={(e) => setTextToContinue(e.target.value)}\r\n                  className=\"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500\"\r\n                  placeholder=\"Enter text to continue...\"\r\n                  rows=\"3\"\r\n                />\r\n                <button\r\n                  onClick={() => handleContinueText(textToContinue, currentConversationId)}\r\n                  className=\"w-full bg-indigo-500 text-white p-3 rounded-lg shadow-md hover:bg-indigo-600 transition-colors duration-200 mt-2\"\r\n                  disabled={isAIGenerating || !textToContinue}\r\n                >\r\n                  Continue\r\n                </button>\r\n              </div>\r\n              <div>\r\n                <h3 className=\"text-lg font-semibold mb-2\">Translate Text</h3>\r\n                <textarea\r\n                  value={textToTranslate}\r\n                  onChange={(e) => setTextToTranslate(e.target.value)}\r\n                  className=\"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500\"\r\n                  placeholder=\"Enter text to translate...\"\r\n                  rows=\"3\"\r\n                />\r\n                <select\r\n                  value={translationTargetLanguage}\r\n                  onChange={(e) => setTranslationTargetLanguage(e.target.value)}\r\n                  className=\"w-full p-3 mt-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500\"\r\n                >\r\n                  <option value=\"en-US\">English</option>\r\n                  <option value=\"es-US\">Spanish</option>\r\n                  <option value=\"fr-FR\">French</option>\r\n                  <option value=\"de-DE\">German</option>\r\n                  <option value=\"ja-JP\">Japanese</option>\r\n                  <option value=\"zh-CN\">Chinese</option>\r\n                </select>\r\n                <button\r\n                  onClick={() => handleTranslateText(textToTranslate, translationTargetLanguage, currentConversationId)}\r\n                  className=\"w-full bg-indigo-500 text-white p-3 rounded-lg shadow-md hover:bg-indigo-600 transition-colors duration-200 mt-2\"\r\n                  disabled={isAIGenerating || !textToTranslate}\r\n                >\r\n                  Translate\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>,\r\n        document.body\r\n      )}\r\n\r\n      {/* Settings Modal */}\r\n      {showSettingsModal && createPortal(\r\n        <div className=\"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-white dark:bg-gray-900 rounded-xl shadow-lg p-6 w-full max-w-md mx-4\">\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n              <h2 className=\"text-xl font-bold\">App Settings</h2>\r\n              <button onClick={() => setShowSettingsModal(false)} className=\"p-1 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700\">\r\n                <X className=\"h-5 w-5\" />\r\n              </button>\r\n            </div>\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <h3 className=\"text-lg font-semibold mb-2\">TTS Settings</h3>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Voice</label>\r\n                <select\r\n                  value={voiceName}\r\n                  onChange={(e) => setVoiceName(e.target.value)}\r\n                  className=\"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500\"\r\n                >\r\n                  {prebuiltVoices.map((voice) => (\r\n                    <option key={voice} value={voice}>{voice}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>,\r\n        document.body\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
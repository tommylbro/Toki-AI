{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Tommy\\\\Desktop\\\\my-chatbot-app\\\\src\\\\App.js\",\n  _s = $RefreshSig$();\n// This line tells ESLint to ignore the following global variables that are provided by the Canvas environment.\n/* global __app_id, __firebase_config, __initial_auth_token */\n\nimport { useState, useEffect, useRef } from 'react';\n// Import the core Firebase App and Analytics functions\nimport { initializeApp, getApps, getApp } from 'firebase/app';\nimport { getAuth, signInWithCustomToken, signInAnonymously } from 'firebase/auth';\nimport { getFirestore, collection, query, onSnapshot, addDoc, serverTimestamp } from 'firebase/firestore';\nimport { getAnalytics } from \"firebase/analytics\";\nimport { Send, Bot } from 'lucide-react'; // Using Lucide for a modern icon\n\n// This is the main App component for our chat application.\n// It handles all the UI, state management, and Firebase interactions.\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function App() {\n  _s();\n  // State to hold the chat messages. An array of objects.\n  const [messages, setMessages] = useState([]);\n  // State to hold the user's input in the text field.\n  const [input, setInput] = useState('');\n  // State to hold the Firebase database instance.\n  const [db, setDb] = useState(null);\n  // State to hold the current user's ID.\n  const [userId, setUserId] = useState(null);\n  // State to track if the application is ready and authenticated.\n  const [isReady, setIsReady] = useState(false);\n  // State to track if an AI response is being generated.\n  const [isAIGenerating, setIsAIGenerating] = useState(false);\n  // State to hold any authentication or initialization errors.\n  const [error, setError] = useState(null);\n  // State to track if the app is in demo mode.\n  const [isDemoMode, setIsDemoMode] = useState(false);\n  // A ref to automatically scroll to the latest message.\n  const messagesEndRef = useRef(null);\n\n  // useEffect to handle Firebase initialization and authentication.\n  // The empty dependency array `[]` ensures this runs only once on component mount.\n  useEffect(() => {\n    // These are provided by the Canvas environment.\n    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\n    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;\n\n    // Your web app's Firebase configuration\n    // For Firebase JS SDK v7.20.0 and later, measurementId is optional\n    const defaultFirebaseConfig = {\n      apiKey: \"AIzaSyDhJoNaFf0qgl4VTuUXj16ysJG1hycq-p8\",\n      authDomain: \"ai-chatbot-88602.firebaseapp.com\",\n      projectId: \"ai-chatbot-88602\",\n      storageBucket: \"ai-chatbot-88602.firebasestorage.app\",\n      messagingSenderId: \"167580287666\",\n      appId: \"1:167580287666:web:9e8313ae6e667e47d47fab\",\n      measurementId: \"G-CXKJ8QRLZ1\"\n    };\n    let firebaseConfig = {};\n    try {\n      firebaseConfig = typeof __firebase_config !== 'undefined' && __firebase_config ? JSON.parse(__firebase_config) : defaultFirebaseConfig;\n    } catch (e) {\n      console.error(\"Failed to parse __firebase_config, using default config.\", e);\n      firebaseConfig = defaultFirebaseConfig;\n    }\n\n    // Check if the firebaseConfig object is valid before proceeding.\n    if (!firebaseConfig || !firebaseConfig.projectId || firebaseConfig.projectId === \"your-project-id\") {\n      console.warn(\"Firebase configuration not provided, running in demo mode.\");\n      setIsReady(true);\n      setIsDemoMode(true);\n      setMessages([{\n        id: '1',\n        userId: 'bot',\n        text: 'Welcome to the AI Chatbot! This app is currently in read-only mode because a Firebase configuration was not provided. Please add a valid config to enable full functionality.'\n      }, {\n        id: '2',\n        userId: 'bot',\n        text: 'You can still view the UI and how the chat would look. To get started, provide your Firebase config and security rules.'\n      }]);\n      // Return here to prevent the rest of the effect from running and trying to connect to Firebase.\n      return;\n    }\n    const initFirebase = async () => {\n      let retryCount = 0;\n      const maxRetries = 3;\n      let success = false;\n      let lastError = null;\n      while (retryCount < maxRetries && !success) {\n        try {\n          // Initialize Firebase application.\n          const app = getApps().length ? getApp() : initializeApp(firebaseConfig);\n          // Initialize Firebase Analytics\n          const analytics = getAnalytics(app);\n\n          // Get the Firestore and Auth instances.\n          const firestore = getFirestore(app);\n          const authInstance = getAuth(app);\n\n          // Sign in the user.\n          let user;\n          if (initialAuthToken) {\n            user = (await signInWithCustomToken(authInstance, initialAuthToken)).user;\n          } else {\n            user = (await signInAnonymously(authInstance)).user;\n          }\n          if (user) {\n            console.log(\"User signed in with UID:\", user.uid);\n            setUserId(user.uid);\n            setDb(firestore);\n            setIsReady(true);\n            setError(null); // Clear any previous errors on successful sign-in\n            success = true; // Mark as successful to exit the loop\n          } else {\n            throw new Error(\"User sign-in failed.\");\n          }\n        } catch (e) {\n          lastError = e;\n          retryCount++;\n          console.error(`Firebase initialization failed (attempt ${retryCount}/${maxRetries}):`, e.message);\n          // Wait before retrying\n          if (retryCount < maxRetries) {\n            await new Promise(resolve => setTimeout(resolve, 1000 * retryCount));\n          }\n        }\n      }\n      if (!success) {\n        // If all retries fail, set the final error\n        console.error(\"All Firebase initialization attempts failed:\", lastError);\n        setError(`Error: Firebase initialization failed. ${lastError.message}`);\n        setIsReady(false);\n      }\n    };\n    initFirebase();\n  }, []); // The empty array ensures this effect runs only once.\n\n  // useEffect to listen for real-time updates to the chat messages from Firestore.\n  // This effect will run whenever `isReady` or `db` changes.\n  useEffect(() => {\n    // We only attach the listener if Firebase is fully initialized, authenticated, and not in demo mode.\n    if (isReady && db && !isDemoMode) {\n      // Define the collection path for our chat messages.\n      // This path is for public data, so all users can see it.\n      const currentAppId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\n      const path = `/artifacts/${currentAppId}/public/data/messages`;\n\n      // Create a query to get messages from the 'messages' collection, ordered by timestamp.\n      const q = query(collection(db, path));\n\n      // Use `onSnapshot` for real-time listening.\n      const unsubscribe = onSnapshot(q, querySnapshot => {\n        const fetchedMessages = [];\n        querySnapshot.forEach(doc => {\n          fetchedMessages.push({\n            id: doc.id,\n            ...doc.data()\n          });\n        });\n        // Sort the messages by timestamp to ensure they are in the correct order.\n        fetchedMessages.sort((a, b) => {\n          var _a$timestamp, _b$timestamp;\n          return (((_a$timestamp = a.timestamp) === null || _a$timestamp === void 0 ? void 0 : _a$timestamp.toMillis()) || 0) - (((_b$timestamp = b.timestamp) === null || _b$timestamp === void 0 ? void 0 : _b$timestamp.toMillis()) || 0);\n        });\n        setMessages(fetchedMessages);\n      }, error => {\n        console.error(\"Error fetching messages:\", error);\n        setError(\"Failed to fetch messages. Check your Firestore rules.\");\n      });\n\n      // The return function from `useEffect` is a cleanup function.\n      // It will unsubscribe from the listener when the component unmounts.\n      return () => unsubscribe();\n    }\n  }, [isReady, db, isDemoMode]);\n\n  // Use a separate useEffect to handle AI responses to user messages\n  useEffect(() => {\n    // Don't run if in demo mode\n    if (isDemoMode) return;\n    const lastMessage = messages[messages.length - 1];\n    // Check if the last message is from the user and an AI response is not already in progress.\n    if (db && lastMessage && lastMessage.userId === userId && !isAIGenerating) {\n      const getAIResponse = async () => {\n        setIsAIGenerating(true);\n        console.log(\"[AI] User sent a message. Generating AI response...\");\n        try {\n          // Prepare chat history for the API call.\n          // Note: The `map` function here creates a new array of objects with\n          // the required `role` and `parts` structure for the API.\n          const chatHistory = messages.map(msg => ({\n            role: msg.userId === userId ? 'user' : 'model',\n            parts: [{\n              text: msg.text\n            }]\n          }));\n          const payload = {\n            contents: chatHistory\n          };\n          const apiKey = \"\"; // API key is automatically provided by the Canvas environment\n          const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;\n\n          // Use exponential backoff for API calls to handle potential throttling\n          let response;\n          let retryCount = 0;\n          const maxRetries = 5;\n          const initialDelay = 1000;\n          while (retryCount < maxRetries) {\n            try {\n              response = await fetch(apiUrl, {\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(payload)\n              });\n              if (response.status !== 429) {\n                // 429 is Too Many Requests\n                break; // Success or non-retryable error, so break\n              }\n              // If we get a 429, log it and prepare for retry\n              console.warn(`[API] Rate limit hit. Retrying in ${initialDelay * Math.pow(2, retryCount)}ms...`);\n              await new Promise(resolve => setTimeout(resolve, initialDelay * Math.pow(2, retryCount)));\n              retryCount++;\n            } catch (fetchError) {\n              // Non-HTTP errors (e.g., network issues)\n              console.error(`[API] Fetch failed. Retrying...`, fetchError);\n              await new Promise(resolve => setTimeout(resolve, initialDelay * Math.pow(2, retryCount)));\n              retryCount++;\n            }\n          }\n          if (!response || !response.ok) {\n            var _response;\n            throw new Error(`API error: ${((_response = response) === null || _response === void 0 ? void 0 : _response.statusText) || 'Unknown error'}`);\n          }\n          const result = await response.json();\n          let responseText = \"Sorry, I couldn't generate a response.\";\n          if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {\n            responseText = result.candidates[0].content.parts[0].text;\n            console.log(\"[AI] Generated AI response successfully.\");\n          }\n\n          // Add the AI's response to Firestore.\n          const currentAppId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\n          const path = `/artifacts/${currentAppId}/public/data/messages`;\n          await addDoc(collection(db, path), {\n            text: responseText,\n            userId: 'bot',\n            // Use a consistent ID for the bot\n            timestamp: serverTimestamp()\n          });\n        } catch (e) {\n          console.error(\"[AI ERROR] Error getting AI response:\", e);\n          // Add an error message from the bot if the API call fails.\n          const currentAppId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\n          const path = `/artifacts/${currentAppId}/public/data/messages`;\n          await addDoc(collection(db, path), {\n            text: `Sorry, I am having trouble processing that request. Error: ${e.message}`,\n            userId: 'bot',\n            timestamp: serverTimestamp()\n          });\n        } finally {\n          setIsAIGenerating(false);\n        }\n      };\n      getAIResponse();\n    }\n  }, [messages, db, isAIGenerating, userId, isDemoMode]);\n\n  // Function to handle sending a new message.\n  const handleSendMessage = async () => {\n    // Don't send messages if in demo mode\n    if (input.trim() === '' || !db || !userId || isDemoMode) {\n      console.log(\"Cannot send empty message or Firebase not ready.\");\n      return;\n    }\n    try {\n      // Define the path for the public chat messages.\n      const currentAppId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\n      const path = `/artifacts/${currentAppId}/public/data/messages`;\n\n      // Add a new document to the 'messages' collection with the user ID, message text, and a timestamp.\n      await addDoc(collection(db, path), {\n        text: input,\n        userId: userId,\n        timestamp: serverTimestamp()\n      });\n      // Clear the input field after sending.\n      setInput('');\n    } catch (error) {\n      console.error(\"Error adding document: \", error);\n      setError(\"Failed to send message. Please try again.\");\n    }\n  };\n\n  // Function to handle key presses in the input field.\n  const handleKeyDown = event => {\n    // If the 'Enter' key is pressed, send the message.\n    if (event.key === 'Enter') {\n      handleSendMessage();\n    }\n  };\n\n  // A useEffect to scroll the chat window to the bottom whenever new messages arrive.\n  useEffect(() => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: 'smooth'\n    });\n  }, [messages]);\n\n  // CSS for the dot-flashing loading animation. This is in a template literal\n  // because we don't have an external CSS file for React immersives.\n  const dotFlashingCss = `\n    .dot-flashing {\n      position: relative;\n      width: 5px;\n      height: 5px;\n      border-radius: 5px;\n      background-color: #efefef;\n      color: #efefef;\n      animation: dotFlashing 1s infinite linear alternate;\n      animation-delay: .5s;\n    }\n    .dot-flashing::before, .dot-flashing::after {\n      content: '';\n      display: inline-block;\n      position: absolute;\n      top: 0;\n    }\n    .dot-flashing::before {\n      left: -10px;\n      width: 5px;\n      height: 5px;\n      border-radius: 5px;\n      background-color: #efefef;\n      color: #efefef;\n      animation: dotFlashing 1s infinite alternate;\n    }\n    .dot-flashing::after {\n      left: 10px;\n      width: 5px;\n      height: 5px;\n      border-radius: 5px;\n      background-color: #efefef;\n      color: #efefef;\n      animation: dotFlashing 1s infinite alternate;\n      animation-delay: 1s;\n    }\n    @keyframes dotFlashing {\n      0% { background-color: #efefef; }\n      50%, 100% { background-color: #9e9e9e; }\n    }\n  `;\n  return (\n    /*#__PURE__*/\n    // Main container with a dark background and full viewport height/width.\n    // It uses flexbox to center the chat container both horizontally and vertically.\n    _jsxDEV(\"div\", {\n      className: \"flex flex-col items-center justify-center min-h-screen p-4 bg-slate-900 font-inter\",\n      children: [/*#__PURE__*/_jsxDEV(\"style\", {\n        children: dotFlashingCss\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 348,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex flex-col w-full max-w-sm md:max-w-md bg-slate-800 rounded-2xl shadow-xl overflow-hidden h-[80vh]\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-4 bg-slate-700 text-white text-center text-lg font-semibold border-b border-slate-600 rounded-t-2xl\",\n          children: \"AI Chatbot\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 354,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex-1 p-4 overflow-y-auto space-y-4\",\n          children: [!isReady && !error && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-center text-slate-400 mt-10\",\n            children: \"Initializing Firebase...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 362,\n            columnNumber: 13\n          }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-center text-red-400 mt-10 p-4 bg-red-900 rounded-lg\",\n            children: [\"Error: \", error]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 367,\n            columnNumber: 13\n          }, this), isReady && !error && messages.map((message, index) =>\n          /*#__PURE__*/\n          // A message bubble. We use different styles for the current user's messages and the bot's.\n          _jsxDEV(\"div\", {\n            className: `flex ${message.userId === userId || isDemoMode ? 'justify-end' : 'justify-start'}`,\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `max-w-[70%] p-3 rounded-2xl shadow-md ${message.userId === userId || isDemoMode ? 'bg-blue-600 text-white' // User's message style\n              : 'bg-slate-700 text-slate-100' // Bot's message style\n              } ${message.userId === userId || isDemoMode ? 'rounded-br-none' // Make the bottom-right corner sharp for user messages\n              : 'rounded-bl-none' // Make the bottom-left corner sharp for bot messages\n              }`,\n              children: [message.userId === 'bot' && /*#__PURE__*/_jsxDEV(Bot, {\n                size: 16,\n                className: \"inline-block mr-2\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 389,\n                columnNumber: 46\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-sm break-words inline-block\",\n                children: message.text\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 391,\n                columnNumber: 17\n              }, this), message.userId !== 'bot' && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"text-xs text-slate-400 mt-1\",\n                children: [\"User: \", message.userId.substring(0, 8), \"...\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 394,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 377,\n              columnNumber: 15\n            }, this)\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 373,\n            columnNumber: 13\n          }, this)), isAIGenerating && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-start justify-start\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"p-3 rounded-2xl bg-slate-700 text-slate-100 max-w-[70%] rounded-bl-none\",\n              children: [/*#__PURE__*/_jsxDEV(Bot, {\n                size: 16,\n                className: \"inline-block mr-2\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 406,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"dot-flashing inline-block align-middle ml-2\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 407,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 405,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 404,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            ref: messagesEndRef\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 413,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 359,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-4 bg-slate-700 border-t border-slate-600 rounded-b-2xl flex items-center\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            className: \"flex-1 p-3 bg-slate-800 text-white placeholder-slate-400 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all\",\n            placeholder: isDemoMode ? \"App is in read-only mode\" : \"Type your message...\",\n            value: input,\n            onChange: e => setInput(e.target.value),\n            onKeyDown: handleKeyDown\n            // Disable input if not ready, in demo mode, or if an error occurred\n            ,\n            disabled: !isReady || isAIGenerating || !!error || isDemoMode\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 419,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleSendMessage,\n            className: \"ml-3 p-3 bg-blue-600 text-white rounded-full shadow-lg hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed\",\n            disabled: !isReady || input.trim() === '' || isAIGenerating || !!error || isDemoMode,\n            children: /*#__PURE__*/_jsxDEV(Send, {\n              size: 20\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 436,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 430,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 417,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 351,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 346,\n      columnNumber: 5\n    }, this)\n  );\n}\n_s(App, \"iuOHhlVV0Ea3/0gc9eV4f3v0S1Q=\");\n_c = App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["useState","useEffect","useRef","initializeApp","getApps","getApp","getAuth","signInWithCustomToken","signInAnonymously","getFirestore","collection","query","onSnapshot","addDoc","serverTimestamp","getAnalytics","Send","Bot","jsxDEV","_jsxDEV","App","_s","messages","setMessages","input","setInput","db","setDb","userId","setUserId","isReady","setIsReady","isAIGenerating","setIsAIGenerating","error","setError","isDemoMode","setIsDemoMode","messagesEndRef","appId","__app_id","initialAuthToken","__initial_auth_token","defaultFirebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","measurementId","firebaseConfig","__firebase_config","JSON","parse","e","console","warn","id","text","initFirebase","retryCount","maxRetries","success","lastError","app","length","analytics","firestore","authInstance","user","log","uid","Error","message","Promise","resolve","setTimeout","currentAppId","path","q","unsubscribe","querySnapshot","fetchedMessages","forEach","doc","push","data","sort","a","b","_a$timestamp","_b$timestamp","timestamp","toMillis","lastMessage","getAIResponse","chatHistory","map","msg","role","parts","payload","contents","apiUrl","response","initialDelay","fetch","method","headers","body","stringify","status","Math","pow","fetchError","ok","_response","statusText","result","json","responseText","candidates","content","handleSendMessage","trim","handleKeyDown","event","key","_messagesEndRef$curre","current","scrollIntoView","behavior","dotFlashingCss","className","children","fileName","_jsxFileName","lineNumber","columnNumber","index","size","substring","ref","type","placeholder","value","onChange","target","onKeyDown","disabled","onClick","_c","$RefreshReg$"],"sources":["C:/Users/Tommy/Desktop/my-chatbot-app/src/App.js"],"sourcesContent":["// This line tells ESLint to ignore the following global variables that are provided by the Canvas environment.\r\n/* global __app_id, __firebase_config, __initial_auth_token */\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\n// Import the core Firebase App and Analytics functions\r\nimport { initializeApp, getApps, getApp } from 'firebase/app';\r\nimport { getAuth, signInWithCustomToken, signInAnonymously } from 'firebase/auth';\r\nimport { getFirestore, collection, query, onSnapshot, addDoc, serverTimestamp } from 'firebase/firestore';\r\nimport { getAnalytics } from \"firebase/analytics\";\r\nimport { Send, Bot } from 'lucide-react'; // Using Lucide for a modern icon\r\n\r\n// This is the main App component for our chat application.\r\n// It handles all the UI, state management, and Firebase interactions.\r\nexport default function App() {\r\n  // State to hold the chat messages. An array of objects.\r\n  const [messages, setMessages] = useState([]);\r\n  // State to hold the user's input in the text field.\r\n  const [input, setInput] = useState('');\r\n  // State to hold the Firebase database instance.\r\n  const [db, setDb] = useState(null);\r\n  // State to hold the current user's ID.\r\n  const [userId, setUserId] = useState(null);\r\n  // State to track if the application is ready and authenticated.\r\n  const [isReady, setIsReady] = useState(false);\r\n  // State to track if an AI response is being generated.\r\n  const [isAIGenerating, setIsAIGenerating] = useState(false);\r\n  // State to hold any authentication or initialization errors.\r\n  const [error, setError] = useState(null);\r\n  // State to track if the app is in demo mode.\r\n  const [isDemoMode, setIsDemoMode] = useState(false);\r\n  // A ref to automatically scroll to the latest message.\r\n  const messagesEndRef = useRef(null);\r\n\r\n  // useEffect to handle Firebase initialization and authentication.\r\n  // The empty dependency array `[]` ensures this runs only once on component mount.\r\n  useEffect(() => {\r\n    // These are provided by the Canvas environment.\r\n    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\r\n    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;\r\n    \r\n    // Your web app's Firebase configuration\r\n    // For Firebase JS SDK v7.20.0 and later, measurementId is optional\r\n    const defaultFirebaseConfig = {\r\n      apiKey: \"AIzaSyDhJoNaFf0qgl4VTuUXj16ysJG1hycq-p8\",\r\n      authDomain: \"ai-chatbot-88602.firebaseapp.com\",\r\n      projectId: \"ai-chatbot-88602\",\r\n      storageBucket: \"ai-chatbot-88602.firebasestorage.app\",\r\n      messagingSenderId: \"167580287666\",\r\n      appId: \"1:167580287666:web:9e8313ae6e667e47d47fab\",\r\n      measurementId: \"G-CXKJ8QRLZ1\"\r\n    };\r\n\r\n    let firebaseConfig = {};\r\n    try {\r\n      firebaseConfig = typeof __firebase_config !== 'undefined' && __firebase_config\r\n        ? JSON.parse(__firebase_config)\r\n        : defaultFirebaseConfig;\r\n    } catch (e) {\r\n      console.error(\"Failed to parse __firebase_config, using default config.\", e);\r\n      firebaseConfig = defaultFirebaseConfig;\r\n    }\r\n\r\n    // Check if the firebaseConfig object is valid before proceeding.\r\n    if (!firebaseConfig || !firebaseConfig.projectId || firebaseConfig.projectId === \"your-project-id\") {\r\n      console.warn(\"Firebase configuration not provided, running in demo mode.\");\r\n      setIsReady(true);\r\n      setIsDemoMode(true);\r\n      setMessages([\r\n        { id: '1', userId: 'bot', text: 'Welcome to the AI Chatbot! This app is currently in read-only mode because a Firebase configuration was not provided. Please add a valid config to enable full functionality.' },\r\n        { id: '2', userId: 'bot', text: 'You can still view the UI and how the chat would look. To get started, provide your Firebase config and security rules.' }\r\n      ]);\r\n      // Return here to prevent the rest of the effect from running and trying to connect to Firebase.\r\n      return;\r\n    }\r\n\r\n    const initFirebase = async () => {\r\n      let retryCount = 0;\r\n      const maxRetries = 3;\r\n      let success = false;\r\n      let lastError = null;\r\n\r\n      while (retryCount < maxRetries && !success) {\r\n        try {\r\n          // Initialize Firebase application.\r\n          const app = getApps().length ? getApp() : initializeApp(firebaseConfig);\r\n          // Initialize Firebase Analytics\r\n          const analytics = getAnalytics(app);\r\n\r\n          // Get the Firestore and Auth instances.\r\n          const firestore = getFirestore(app);\r\n          const authInstance = getAuth(app);\r\n  \r\n          // Sign in the user.\r\n          let user;\r\n          if (initialAuthToken) {\r\n            user = (await signInWithCustomToken(authInstance, initialAuthToken)).user;\r\n          } else {\r\n            user = (await signInAnonymously(authInstance)).user;\r\n          }\r\n  \r\n          if (user) {\r\n            console.log(\"User signed in with UID:\", user.uid);\r\n            setUserId(user.uid);\r\n            setDb(firestore);\r\n            setIsReady(true);\r\n            setError(null); // Clear any previous errors on successful sign-in\r\n            success = true; // Mark as successful to exit the loop\r\n          } else {\r\n            throw new Error(\"User sign-in failed.\");\r\n          }\r\n        } catch (e) {\r\n          lastError = e;\r\n          retryCount++;\r\n          console.error(`Firebase initialization failed (attempt ${retryCount}/${maxRetries}):`, e.message);\r\n          // Wait before retrying\r\n          if (retryCount < maxRetries) {\r\n            await new Promise(resolve => setTimeout(resolve, 1000 * retryCount));\r\n          }\r\n        }\r\n      }\r\n\r\n      if (!success) {\r\n        // If all retries fail, set the final error\r\n        console.error(\"All Firebase initialization attempts failed:\", lastError);\r\n        setError(`Error: Firebase initialization failed. ${lastError.message}`);\r\n        setIsReady(false);\r\n      }\r\n    };\r\n\r\n    initFirebase();\r\n  }, []); // The empty array ensures this effect runs only once.\r\n\r\n  // useEffect to listen for real-time updates to the chat messages from Firestore.\r\n  // This effect will run whenever `isReady` or `db` changes.\r\n  useEffect(() => {\r\n    // We only attach the listener if Firebase is fully initialized, authenticated, and not in demo mode.\r\n    if (isReady && db && !isDemoMode) {\r\n      // Define the collection path for our chat messages.\r\n      // This path is for public data, so all users can see it.\r\n      const currentAppId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\r\n      const path = `/artifacts/${currentAppId}/public/data/messages`;\r\n      \r\n      // Create a query to get messages from the 'messages' collection, ordered by timestamp.\r\n      const q = query(collection(db, path));\r\n      \r\n      // Use `onSnapshot` for real-time listening.\r\n      const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n        const fetchedMessages = [];\r\n        querySnapshot.forEach((doc) => {\r\n          fetchedMessages.push({ id: doc.id, ...doc.data() });\r\n        });\r\n        // Sort the messages by timestamp to ensure they are in the correct order.\r\n        fetchedMessages.sort((a, b) => (a.timestamp?.toMillis() || 0) - (b.timestamp?.toMillis() || 0));\r\n        setMessages(fetchedMessages);\r\n      }, (error) => {\r\n        console.error(\"Error fetching messages:\", error);\r\n        setError(\"Failed to fetch messages. Check your Firestore rules.\");\r\n      });\r\n      \r\n      // The return function from `useEffect` is a cleanup function.\r\n      // It will unsubscribe from the listener when the component unmounts.\r\n      return () => unsubscribe();\r\n    }\r\n  }, [isReady, db, isDemoMode]);\r\n\r\n  // Use a separate useEffect to handle AI responses to user messages\r\n  useEffect(() => {\r\n    // Don't run if in demo mode\r\n    if (isDemoMode) return;\r\n\r\n    const lastMessage = messages[messages.length - 1];\r\n    // Check if the last message is from the user and an AI response is not already in progress.\r\n    if (db && lastMessage && lastMessage.userId === userId && !isAIGenerating) {\r\n      const getAIResponse = async () => {\r\n        setIsAIGenerating(true);\r\n        console.log(\"[AI] User sent a message. Generating AI response...\");\r\n\r\n        try {\r\n          // Prepare chat history for the API call.\r\n          // Note: The `map` function here creates a new array of objects with\r\n          // the required `role` and `parts` structure for the API.\r\n          const chatHistory = messages.map(msg => ({\r\n            role: msg.userId === userId ? 'user' : 'model',\r\n            parts: [{ text: msg.text }]\r\n          }));\r\n          \r\n          const payload = { contents: chatHistory };\r\n          const apiKey = \"\"; // API key is automatically provided by the Canvas environment\r\n          const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;\r\n          \r\n          // Use exponential backoff for API calls to handle potential throttling\r\n          let response;\r\n          let retryCount = 0;\r\n          const maxRetries = 5;\r\n          const initialDelay = 1000;\r\n\r\n          while (retryCount < maxRetries) {\r\n            try {\r\n              response = await fetch(apiUrl, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(payload)\r\n              });\r\n              if (response.status !== 429) { // 429 is Too Many Requests\r\n                break; // Success or non-retryable error, so break\r\n              }\r\n              // If we get a 429, log it and prepare for retry\r\n              console.warn(`[API] Rate limit hit. Retrying in ${initialDelay * Math.pow(2, retryCount)}ms...`);\r\n              await new Promise(resolve => setTimeout(resolve, initialDelay * Math.pow(2, retryCount)));\r\n              retryCount++;\r\n            } catch (fetchError) {\r\n              // Non-HTTP errors (e.g., network issues)\r\n              console.error(`[API] Fetch failed. Retrying...`, fetchError);\r\n              await new Promise(resolve => setTimeout(resolve, initialDelay * Math.pow(2, retryCount)));\r\n              retryCount++;\r\n            }\r\n          }\r\n          \r\n          if (!response || !response.ok) {\r\n            throw new Error(`API error: ${response?.statusText || 'Unknown error'}`);\r\n          }\r\n\r\n          const result = await response.json();\r\n          let responseText = \"Sorry, I couldn't generate a response.\";\r\n          if (result.candidates && result.candidates.length > 0 &&\r\n              result.candidates[0].content && result.candidates[0].content.parts &&\r\n              result.candidates[0].content.parts.length > 0) {\r\n            responseText = result.candidates[0].content.parts[0].text;\r\n            console.log(\"[AI] Generated AI response successfully.\");\r\n          }\r\n\r\n          // Add the AI's response to Firestore.\r\n          const currentAppId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\r\n          const path = `/artifacts/${currentAppId}/public/data/messages`;\r\n          await addDoc(collection(db, path), {\r\n            text: responseText,\r\n            userId: 'bot', // Use a consistent ID for the bot\r\n            timestamp: serverTimestamp(),\r\n          });\r\n        } catch (e) {\r\n          console.error(\"[AI ERROR] Error getting AI response:\", e);\r\n          // Add an error message from the bot if the API call fails.\r\n          const currentAppId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\r\n          const path = `/artifacts/${currentAppId}/public/data/messages`;\r\n          await addDoc(collection(db, path), {\r\n            text: `Sorry, I am having trouble processing that request. Error: ${e.message}`,\r\n            userId: 'bot',\r\n            timestamp: serverTimestamp(),\r\n          });\r\n        } finally {\r\n          setIsAIGenerating(false);\r\n        }\r\n      };\r\n\r\n      getAIResponse();\r\n    }\r\n  }, [messages, db, isAIGenerating, userId, isDemoMode]);\r\n\r\n  // Function to handle sending a new message.\r\n  const handleSendMessage = async () => {\r\n    // Don't send messages if in demo mode\r\n    if (input.trim() === '' || !db || !userId || isDemoMode) {\r\n      console.log(\"Cannot send empty message or Firebase not ready.\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Define the path for the public chat messages.\r\n      const currentAppId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\r\n      const path = `/artifacts/${currentAppId}/public/data/messages`;\r\n      \r\n      // Add a new document to the 'messages' collection with the user ID, message text, and a timestamp.\r\n      await addDoc(collection(db, path), {\r\n        text: input,\r\n        userId: userId,\r\n        timestamp: serverTimestamp(),\r\n      });\r\n      // Clear the input field after sending.\r\n      setInput('');\r\n    } catch (error) {\r\n      console.error(\"Error adding document: \", error);\r\n      setError(\"Failed to send message. Please try again.\");\r\n    }\r\n  };\r\n\r\n  // Function to handle key presses in the input field.\r\n  const handleKeyDown = (event) => {\r\n    // If the 'Enter' key is pressed, send the message.\r\n    if (event.key === 'Enter') {\r\n      handleSendMessage();\r\n    }\r\n  };\r\n\r\n  // A useEffect to scroll the chat window to the bottom whenever new messages arrive.\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [messages]);\r\n\r\n  // CSS for the dot-flashing loading animation. This is in a template literal\r\n  // because we don't have an external CSS file for React immersives.\r\n  const dotFlashingCss = `\r\n    .dot-flashing {\r\n      position: relative;\r\n      width: 5px;\r\n      height: 5px;\r\n      border-radius: 5px;\r\n      background-color: #efefef;\r\n      color: #efefef;\r\n      animation: dotFlashing 1s infinite linear alternate;\r\n      animation-delay: .5s;\r\n    }\r\n    .dot-flashing::before, .dot-flashing::after {\r\n      content: '';\r\n      display: inline-block;\r\n      position: absolute;\r\n      top: 0;\r\n    }\r\n    .dot-flashing::before {\r\n      left: -10px;\r\n      width: 5px;\r\n      height: 5px;\r\n      border-radius: 5px;\r\n      background-color: #efefef;\r\n      color: #efefef;\r\n      animation: dotFlashing 1s infinite alternate;\r\n    }\r\n    .dot-flashing::after {\r\n      left: 10px;\r\n      width: 5px;\r\n      height: 5px;\r\n      border-radius: 5px;\r\n      background-color: #efefef;\r\n      color: #efefef;\r\n      animation: dotFlashing 1s infinite alternate;\r\n      animation-delay: 1s;\r\n    }\r\n    @keyframes dotFlashing {\r\n      0% { background-color: #efefef; }\r\n      50%, 100% { background-color: #9e9e9e; }\r\n    }\r\n  `;\r\n\r\n  return (\r\n    // Main container with a dark background and full viewport height/width.\r\n    // It uses flexbox to center the chat container both horizontally and vertically.\r\n    <div className=\"flex flex-col items-center justify-center min-h-screen p-4 bg-slate-900 font-inter\">\r\n      {/* Inject the custom CSS for the loading animation */}\r\n      <style>{dotFlashingCss}</style>\r\n\r\n      {/* The main chat container. It's a responsive box with a dark background. */}\r\n      <div className=\"flex flex-col w-full max-w-sm md:max-w-md bg-slate-800 rounded-2xl shadow-xl overflow-hidden h-[80vh]\">\r\n        \r\n        {/* Header section for the chat window. */}\r\n        <div className=\"p-4 bg-slate-700 text-white text-center text-lg font-semibold border-b border-slate-600 rounded-t-2xl\">\r\n          AI Chatbot\r\n        </div>\r\n\r\n        {/* Display area for the messages. It's a scrollable container. */}\r\n        <div className=\"flex-1 p-4 overflow-y-auto space-y-4\">\r\n          {/* Display loading, error, or messages */}\r\n          {!isReady && !error && (\r\n            <div className=\"text-center text-slate-400 mt-10\">\r\n              Initializing Firebase...\r\n            </div>\r\n          )}\r\n          {error && (\r\n            <div className=\"text-center text-red-400 mt-10 p-4 bg-red-900 rounded-lg\">\r\n              Error: {error}\r\n            </div>\r\n          )}\r\n          {isReady && !error && messages.map((message, index) => (\r\n            // A message bubble. We use different styles for the current user's messages and the bot's.\r\n            <div\r\n              key={index}\r\n              className={`flex ${message.userId === userId || isDemoMode ? 'justify-end' : 'justify-start'}`}\r\n            >\r\n              <div\r\n                className={`max-w-[70%] p-3 rounded-2xl shadow-md ${\r\n                  message.userId === userId || isDemoMode\r\n                    ? 'bg-blue-600 text-white' // User's message style\r\n                    : 'bg-slate-700 text-slate-100' // Bot's message style\r\n                } ${\r\n                  message.userId === userId || isDemoMode\r\n                    ? 'rounded-br-none' // Make the bottom-right corner sharp for user messages\r\n                    : 'rounded-bl-none' // Make the bottom-left corner sharp for bot messages\r\n                }`}\r\n              >\r\n                {/* Conditionally render the bot icon for bot messages */}\r\n                {message.userId === 'bot' && <Bot size={16} className=\"inline-block mr-2\" />}\r\n                {/* The message text. */}\r\n                <p className=\"text-sm break-words inline-block\">{message.text}</p>\r\n                {/* Optional: Display the user ID for collaborative context */}\r\n                {message.userId !== 'bot' && (\r\n                  <div className=\"text-xs text-slate-400 mt-1\">\r\n                    User: {message.userId.substring(0, 8)}...\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          ))}\r\n\r\n          {/* AI generating message indicator */}\r\n          {isAIGenerating && (\r\n            <div className=\"flex items-start justify-start\">\r\n              <div className=\"p-3 rounded-2xl bg-slate-700 text-slate-100 max-w-[70%] rounded-bl-none\">\r\n                <Bot size={16} className=\"inline-block mr-2\" />\r\n                <div className=\"dot-flashing inline-block align-middle ml-2\" />\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* This empty div is our scroll anchor. */}\r\n          <div ref={messagesEndRef} />\r\n        </div>\r\n\r\n        {/* Input area for sending messages. */}\r\n        <div className=\"p-4 bg-slate-700 border-t border-slate-600 rounded-b-2xl flex items-center\">\r\n          {/* The text input field. */}\r\n          <input\r\n            type=\"text\"\r\n            className=\"flex-1 p-3 bg-slate-800 text-white placeholder-slate-400 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all\"\r\n            placeholder={isDemoMode ? \"App is in read-only mode\" : \"Type your message...\"}\r\n            value={input}\r\n            onChange={(e) => setInput(e.target.value)}\r\n            onKeyDown={handleKeyDown}\r\n            // Disable input if not ready, in demo mode, or if an error occurred\r\n            disabled={!isReady || isAIGenerating || !!error || isDemoMode}\r\n          />\r\n          {/* The send button. It's disabled if the input is empty or not authenticated. */}\r\n          <button\r\n            onClick={handleSendMessage}\r\n            className=\"ml-3 p-3 bg-blue-600 text-white rounded-full shadow-lg hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            disabled={!isReady || input.trim() === '' || isAIGenerating || !!error || isDemoMode}\r\n          >\r\n            {/* Using the Send icon from lucide-react */}\r\n            <Send size={20} />\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}